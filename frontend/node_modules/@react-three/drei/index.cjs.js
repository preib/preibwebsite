"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),t=require("react"),r=require("react-dom"),n=require("three"),o=require("@react-three/fiber"),a=require("zustand"),s=require("react-merge-refs"),i=require("@react-spring/three"),l=require("@use-gesture/react"),u=require("three-stdlib"),c=require("troika-three-text"),d=require("lodash.omit"),m=require("lodash.pick"),f=require("three/examples/js/libs/stats.min"),h=require("detect-gpu"),p=require("use-asset"),v=require("three-mesh-bvh"),g=require("react-composer");function x(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function y(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var w=x(e),E=y(t),b=y(r),M=y(n),S=x(a),T=x(s),R=x(d),C=x(m),_=x(f),L=x(g);const P=new n.Vector3,D=new n.Vector3,z=new n.Vector3;function B(e,t,r){const n=P.setFromMatrixPosition(e.matrixWorld);n.project(t);const o=r.width/2,a=r.height/2;return[n.x*o+o,-n.y*a+a]}const U=e=>Math.abs(e)<1e-10?0:e;function A(e,t,r=""){let n="matrix3d(";for(let r=0;16!==r;r++)n+=U(t[r]*e.elements[r])+(15!==r?",":")");return r+n}const F=(k=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>A(e,k));var k;const j=(e,t)=>{return A(e,[1/(r=t),1/r,1/r,1,-1/r,-1/r,-1/r,-1,1/r,1/r,1/r,1,1,1,1,1],"translate(-50%,-50%)");var r},I=E.forwardRef((({children:e,eps:t=.001,style:r,className:a,prepend:s,center:i,fullscreen:l,portal:u,distanceFactor:c,sprite:d=!1,transform:m=!1,occlude:f,onOcclude:h,zIndexRange:p=[16777271,0],calculatePosition:v=B,as:g="div",wrapperClass:x,pointerEvents:y="auto",...M},S)=>{var T;const R=o.useThree((({gl:e})=>e)),C=o.useThree((({camera:e})=>e)),_=o.useThree((({scene:e})=>e)),L=o.useThree((({size:e})=>e)),A=o.useThree((({raycaster:e})=>e)),[k]=E.useState((()=>document.createElement(g))),I=E.useRef(null),V=E.useRef(0),O=E.useRef([0,0]),G=E.useRef(null),W=E.useRef(null),N=null!==(T=null==u?void 0:u.current)&&void 0!==T?T:R.domElement.parentNode;E.useEffect((()=>{if(I.current){if(_.updateMatrixWorld(),m)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=v(I.current,C,L);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return N&&(s?N.prepend(k):N.appendChild(k)),()=>{N&&N.removeChild(k),b.unmountComponentAtNode(k)}}}),[N,m]),E.useLayoutEffect((()=>{x&&(k.className=x)}),[x]);const H=E.useMemo((()=>m?{position:"absolute",top:0,left:0,width:L.width,height:L.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:i?"translate3d(-50%,-50%,0)":"none",...l&&{top:-L.height/2,left:-L.width/2,width:L.width,height:L.height},...r}),[r,i,l,L,m]),q=E.useMemo((()=>({position:"absolute",pointerEvents:y})),[y]);E.useLayoutEffect((()=>{m?b.render(E.createElement("div",{ref:G,style:H},E.createElement("div",{ref:W,style:q},E.createElement("div",{ref:S,className:a,style:r,children:e}))),k):b.render(E.createElement("div",{ref:S,style:H,className:a,children:e}),k)}));const $=E.useRef(!0);return o.useFrame((()=>{if(I.current){C.updateMatrixWorld(),I.current.updateWorldMatrix(!0,!1);const e=m?O.current:v(I.current,C,L);if(m||Math.abs(V.current-C.zoom)>t||Math.abs(O.current[0]-e[0])>t||Math.abs(O.current[1]-e[1])>t){const t=function(e,t){const r=P.setFromMatrixPosition(e.matrixWorld),n=D.setFromMatrixPosition(t.matrixWorld),o=r.sub(n),a=t.getWorldDirection(z);return o.angleTo(a)>Math.PI/2}(I.current,C);let r=!1;"boolean"==typeof f?!0===f&&(r=[_]):Array.isArray(f)&&(r=f.map((e=>e.current)));const o=$.current;if(r){const e=function(e,t,r,n){const o=P.setFromMatrixPosition(e.matrixWorld),a=o.clone();a.project(t),r.setFromCamera(a,t);const s=r.intersectObjects(n,!0);if(s.length){const e=s[0].distance;return o.distanceTo(r.ray.origin)<e}return!0}(I.current,C,A,r);$.current=e&&!t}else $.current=!t;if(o!==$.current&&(h?h(!$.current):k.style.display=$.current?"block":"none"),k.style.zIndex=`${function(e,t,r){if(t instanceof n.PerspectiveCamera||t instanceof n.OrthographicCamera){const n=P.setFromMatrixPosition(e.matrixWorld),o=D.setFromMatrixPosition(t.matrixWorld),a=n.distanceTo(o),s=(r[1]-r[0])/(t.far-t.near),i=r[1]-s*t.far;return Math.round(s*a+i)}}(I.current,C,p)}`,m){const[e,t]=[L.width/2,L.height/2],r=C.projectionMatrix.elements[5]*t,{isOrthographicCamera:n,top:o,left:a,bottom:s,right:i}=C,l=F(C.matrixWorldInverse),u=n?`scale(${r})translate(${U(-(i+a)/2)}px,${U((o+s)/2)}px)`:`translateZ(${r}px)`;let m=I.current.matrixWorld;d&&(m=C.matrixWorldInverse.clone().transpose().copyPosition(m).scale(I.current.scale),m.elements[3]=m.elements[7]=m.elements[11]=0,m.elements[15]=1),k.style.width=L.width+"px",k.style.height=L.height+"px",k.style.perspective=n?"":`${r}px`,G.current&&W.current&&(G.current.style.transform=`${u}${l}translate(${e}px,${t}px)`,W.current.style.transform=j(m,1/((c||10)/400)))}else{const t=void 0===c?1:function(e,t){if(t instanceof n.OrthographicCamera)return t.zoom;if(t instanceof n.PerspectiveCamera){const r=P.setFromMatrixPosition(e.matrixWorld),n=D.setFromMatrixPosition(t.matrixWorld),o=t.fov*Math.PI/180,a=r.distanceTo(n);return 1/(2*Math.tan(o/2)*a)}return 1}(I.current,C)*c;k.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}O.current=e,V.current=C.zoom}}})),E.createElement("group",w.default({},M,{ref:I}))}));let V=0;const O=S.default((e=>(n.DefaultLoadingManager.onStart=(t,r,n)=>{e({active:!0,item:t,loaded:r,total:n,progress:(r-V)/(n-V)*100})},n.DefaultLoadingManager.onLoad=()=>{e({active:!1})},n.DefaultLoadingManager.onError=t=>e((e=>({errors:[...e.errors,t]}))),n.DefaultLoadingManager.onProgress=(t,r,n)=>{r===n&&(V=n),e({active:!0,item:t,loaded:r,total:n,progress:(r-V)/(n-V)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}))),G=e=>`Loading ${e.toFixed(2)}%`;const W={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}},N=E.createContext(null);function H(){return E.useContext(N)}const q=E.forwardRef((({children:e},t)=>{const r=E.useRef(null),n=H(),{width:a,height:s}=o.useThree((e=>e.viewport));return o.useFrame((()=>{r.current.position.x=n.horizontal?-a*(n.pages-1)*n.offset:0,r.current.position.y=n.horizontal?0:s*(n.pages-1)*n.offset})),E.createElement("group",{ref:T.default([t,r])},e)})),$=E.forwardRef((({children:e,style:t,...r},n)=>{const a=H(),s=E.useRef(null),{width:i,height:l}=o.useThree((e=>e.size)),u=E.useContext(o.context);return o.useFrame((()=>{a.delta>a.eps&&(s.current.style.transform=`translate3d(${a.horizontal?-i*(a.pages-1)*a.offset:0}px,${a.horizontal?0:l*(a.pages-1)*-a.offset}px,0)`)})),b.render(E.createElement("div",w.default({ref:T.default([n,s]),style:{...t,position:"absolute",top:0,left:0,willChange:"transform"}},r),E.createElement(N.Provider,{value:a},E.createElement(o.context.Provider,{value:u},e))),a.fixed),null})),Z=E.forwardRef((({html:e,...t},r)=>{const n=e?$:q;return E.createElement(n,w.default({ref:r},t))}));const X=E.forwardRef((function({follow:e=!0,lockX:t=!1,lockY:r=!1,lockZ:n=!1,...a},s){const i=E.useRef();return o.useFrame((({camera:o})=>{if(!e||!i.current)return;const a=i.current.rotation.clone();i.current.quaternion.copy(o.quaternion),t&&(i.current.rotation.x=a.x),r&&(i.current.rotation.y=a.y),n&&(i.current.rotation.z=a.z)})),E.createElement("group",w.default({ref:T.default([i,s])},a))})),Y=E.forwardRef((function({points:e,color:t="black",vertexColors:r,lineWidth:o,dashed:a,...s},i){const[l]=E.useState((()=>new u.Line2)),[c]=E.useState((()=>new u.LineMaterial)),[d]=E.useState((()=>new n.Vector2(512,512))),m=E.useMemo((()=>{const t=new u.LineGeometry,o=e.map((e=>e instanceof n.Vector3?e.toArray():e));if(t.setPositions(o.flat()),r){const e=r.map((e=>e instanceof n.Color?e.toArray():e));t.setColors(e.flat())}return t}),[e,r]);return E.useLayoutEffect((()=>{l.computeLineDistances()}),[e,l]),E.useLayoutEffect((()=>{a?c.defines.USE_DASH="":delete c.defines.USE_DASH,c.needsUpdate=!0}),[a,c]),E.useEffect((()=>()=>m.dispose()),[m]),E.createElement("primitive",w.default({object:l,ref:i},s),E.createElement("primitive",{object:m,attach:"geometry"}),E.createElement("primitive",w.default({object:c,attach:"material",color:t,vertexColors:Boolean(r),resolution:d,linewidth:o,dashed:a},s)))})),Q=new n.Vector3,K=E.forwardRef((function({start:e=[0,0,0],end:t=[0,0,0],mid:r,segments:o=20,...a},s){const i=E.useRef(null),[l]=E.useState((()=>new n.QuadraticBezierCurve3(void 0,void 0,void 0))),u=E.useCallback(((e,t,r,o=20)=>(e instanceof n.Vector3?l.v0.copy(e):l.v0.set(...e),t instanceof n.Vector3?l.v2.copy(t):l.v2.set(...t),r instanceof n.Vector3?l.v1.copy(r):l.v1.copy(l.v0.clone().add(l.v2.clone().sub(l.v0)).add(Q.set(0,l.v0.y-l.v2.y,0))),l.getPoints(o))),[]);E.useLayoutEffect((()=>{i.current.setPoints=(e,t,r)=>{const n=u(e,t,r);i.current.geometry&&i.current.geometry.setPositions(n.map((e=>e.toArray())).flat())}}),[]);const c=E.useMemo((()=>u(e,t,r,o)),[e,t,r,o]);return E.createElement(Y,w.default({ref:T.default([i,s]),points:c},a))})),J=E.forwardRef((function({start:e,end:t,midA:r,midB:o,segments:a=20,...s},i){const l=E.useMemo((()=>{const s=e instanceof n.Vector3?e:new n.Vector3(...e),i=t instanceof n.Vector3?t:new n.Vector3(...t),l=r instanceof n.Vector3?r:new n.Vector3(...r),u=o instanceof n.Vector3?o:new n.Vector3(...o);return new n.CubicBezierCurve3(s,l,u,i).getPoints(a)}),[e,t,r,o,a]);return E.createElement(Y,w.default({ref:i,points:l},s))})),ee=E.forwardRef((({url:e,distance:t=1,loop:r=!0,autoplay:a,...s},i)=>{const l=E.useRef(),u=o.useThree((({camera:e})=>e)),[c]=E.useState((()=>new n.AudioListener)),d=o.useLoader(n.AudioLoader,e);return E.useEffect((()=>{const e=l.current;e&&(e.setBuffer(d),e.setRefDistance(t),e.setLoop(r),a&&!e.isPlaying&&e.play())}),[d,u,t,r]),E.useEffect((()=>{const e=l.current;return u.add(c),()=>{u.remove(c),e&&(e.isPlaying&&e.stop(),e.source&&e.source._connected&&e.disconnect())}}),[]),E.createElement("positionalAudio",w.default({ref:T.default([l,i]),args:[c]},s))})),te=E.forwardRef((({anchorX:e="center",anchorY:t="middle",children:r,onSync:n,...a},s)=>{const i=o.useThree((({invalidate:e})=>e)),[l]=E.useState((()=>new c.Text)),[u,d]=E.useMemo((()=>{const e=[];let t="";return E.Children.forEach(r,(r=>{"string"==typeof r||"number"==typeof r?t+=r:e.push(r)})),[e,t]}),[r]);return E.useLayoutEffect((()=>{l.sync((()=>{i(),n&&n(l)}))})),E.useEffect((()=>()=>l.dispose()),[l]),E.createElement("primitive",w.default({object:l,ref:s,text:d,anchorX:e,anchorY:t},a),u)}));o.extend({EffectComposer:u.EffectComposer,RenderPass:u.RenderPass,ShaderPass:u.ShaderPass});const re=()=>{try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},ne=E.forwardRef((({children:e,multisamping:t=8,renderIndex:r=1,disableGamma:a=!1,disableRenderPass:s=!1,...i},l)=>{const c=E.useRef(),d=o.useThree((({scene:e})=>e)),m=o.useThree((({camera:e})=>e)),f=o.useThree((({gl:e})=>e)),h=o.useThree((({size:e})=>e)),[p]=E.useState((()=>{if(re()&&t>0){const e=new n.WebGLMultisampleRenderTarget(h.width,h.height,{format:n.RGBAFormat,encoding:n.sRGBEncoding});return e.samples=8,e}}));return E.useEffect((()=>{var e,t;null==(e=c.current)||e.setSize(h.width,h.height),null==(t=c.current)||t.setPixelRatio(f.getPixelRatio())}),[f,h]),o.useFrame((()=>{var e;return null==(e=c.current)?void 0:e.render()}),r),E.createElement("effectComposer",w.default({ref:T.default([l,c]),args:[f,p]},i),!s&&E.createElement("renderPass",{attachArray:"passes",args:[d,m]}),!a&&E.createElement("shaderPass",{attachArray:"passes",args:[u.GammaCorrectionShader]}),e)}));function oe(e,t,r,n){return class extends M.ShaderMaterial{constructor(){const o=Object.entries(e);super({uniforms:o.reduce(((e,[t,r])=>({...e,...M.UniformsUtils.clone({[t]:{value:r}})})),{}),vertexShader:t,fragmentShader:r}),o.forEach((([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))),n&&n(this)}}}const ae=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function se(e){const r=o.useThree((e=>e.gl)),a=o.useLoader(n.TextureLoader,ae(e)?Object.values(e):e);if(t.useEffect((()=>{(Array.isArray(a)?a:[a]).forEach(r.initTexture)}),[r,a]),ae(e)){const t=Object.keys(e),r={};return t.forEach((e=>Object.assign(r,{[e]:a[t.indexOf(e)]}))),r}return a}se.preload=e=>o.useLoader.preload(n.TextureLoader,e),se.clear=e=>o.useLoader.clear(n.TextureLoader,e);const ie=oe({color:new M.Color("white"),scale:[1,1],imageBounds:[1,1],map:null,zoom:1,grayscale:0},"\n  varying vec2 vUv;\n  void main() {\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n    vUv = uv;\n  }\n","\n  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44\n  varying vec2 vUv;\n  uniform vec2 scale;\n  uniform vec2 imageBounds;\n  uniform vec3 color;\n  uniform sampler2D map;\n  uniform float zoom;\n  uniform float grayscale;\n  const vec3 luma = vec3(.299, 0.587, 0.114);\n  vec4 toGrayscale(vec4 color, float intensity) {\n    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);\n  }\n  vec2 aspect(vec2 size) {\n    return size / min(size.x, size.y);\n  }\n  void main() {\n    vec2 s = aspect(scale);\n    vec2 i = aspect(imageBounds);\n    float rs = s.x / s.y;\n    float ri = i.x / i.y;\n    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);\n    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;\n    vec2 uv = vUv * s / new + offset;\n    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);\n    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, 1.0), grayscale);\n  }\n"),le=E.forwardRef((({children:e,color:t,segments:r=1,scale:n=1,zoom:a=1,grayscale:s=0,url:i,...l},u)=>{o.extend({ImageMaterial:ie});const c=se(i),d=Array.isArray(n)?[n[0],n[1]]:[n,n],m=[c.image.width,c.image.height];return E.createElement("mesh",w.default({ref:u,scale:n},l),E.createElement("planeGeometry",{args:[1,1,r,r]}),E.createElement("imageMaterial",{color:t,map:c,zoom:a,grayscale:s,scale:d,imageBounds:m}),e)})),ue=E.forwardRef((({makeDefault:e,...t},r)=>{const n=o.useThree((({set:e})=>e)),a=o.useThree((({camera:e})=>e)),s=o.useThree((({size:e})=>e)),i=E.useRef();return E.useLayoutEffect((()=>{i.current&&!t.manual&&i.current.updateProjectionMatrix()}),[s,t]),E.useLayoutEffect((()=>{if(e&&i.current){const e=a;return n((()=>({camera:i.current}))),()=>n((()=>({camera:e})))}}),[a,i,e,n]),E.createElement("orthographicCamera",w.default({left:s.width/-2,right:s.width/2,top:s.height/2,bottom:s.height/-2,ref:T.default([i,r])},t))})),ce=E.forwardRef((({makeDefault:e,...t},r)=>{const n=o.useThree((({set:e})=>e)),a=o.useThree((({camera:e})=>e)),s=o.useThree((({size:e})=>e)),i=E.useRef();return E.useLayoutEffect((()=>{const{current:e}=i;e&&!t.manual&&(e.aspect=s.width/s.height,e.updateProjectionMatrix())}),[s,t]),E.useLayoutEffect((()=>{if(e&&i.current){const e=a;return n((()=>({camera:i.current}))),()=>n((()=>({camera:e})))}}),[a,i,e,n]),E.createElement("perspectiveCamera",w.default({ref:T.default([i,r])},t))}));const de=E.forwardRef(((e,t)=>{const{camera:r,onChange:n,...a}=e,s=o.useThree((({camera:e})=>e)),i=o.useThree((({invalidate:e})=>e)),l=r||s,[c]=E.useState((()=>new u.DeviceOrientationControls(l)));return E.useEffect((()=>{const e=e=>{i(),n&&n(e)};return null==c||null==c.addEventListener||c.addEventListener("change",e),()=>null==c||null==c.removeEventListener?void 0:c.removeEventListener("change",e)}),[n,c,i]),o.useFrame((()=>null==c?void 0:c.update())),E.useEffect((()=>{const e=c;return null==e||e.connect(),()=>null==e?void 0:e.dispose()}),[c]),c?E.createElement("primitive",w.default({ref:t,dispose:void 0,object:c},a)):null})),me=E.forwardRef(((e,t)=>{const{onChange:r,...n}=e,a=o.useThree((({invalidate:e})=>e)),s=o.useThree((({camera:e})=>e)),i=o.useThree((({gl:e})=>e)),[l]=E.useState((()=>new u.FlyControls(s,i.domElement)));return E.useEffect((()=>{const e=e=>{a(),r&&r(e)};return null==l||null==l.addEventListener||l.addEventListener("change",e),()=>null==l||null==l.removeEventListener?void 0:l.removeEventListener("change",e)}),[r,l,a]),o.useFrame(((e,t)=>null==l?void 0:l.update(t))),l?E.createElement("primitive",w.default({ref:t,dispose:void 0,object:l},n)):null})),fe=E.forwardRef(((e={enableDamping:!0},t)=>{const{camera:r,onChange:n,onStart:a,onEnd:s,...i}=e,l=o.useThree((({invalidate:e})=>e)),c=o.useThree((({camera:e})=>e)),d=o.useThree((({gl:e})=>e.domElement)),m=r||c,f=E.useMemo((()=>new u.MapControls(m)),[m]);return E.useEffect((()=>{f.connect(d);const e=e=>{l(),n&&n(e)};return f.addEventListener("change",e),a&&f.addEventListener("start",a),s&&f.addEventListener("end",s),()=>{f.dispose(),f.removeEventListener("change",e),a&&f.removeEventListener("start",a),s&&f.removeEventListener("end",s)}}),[n,a,s,f,l,d]),o.useFrame((()=>f.update())),E.createElement("primitive",w.default({ref:t,dispose:void 0,object:f,enableDamping:!0},i))})),he=E.forwardRef((({makeDefault:e,camera:t,regress:r,domElement:n,enableDamping:a=!0,onChange:s,onStart:i,onEnd:l,...c},d)=>{const m=o.useThree((({invalidate:e})=>e)),f=o.useThree((({camera:e})=>e)),h=o.useThree((({gl:e})=>e)),p=o.useThree((({events:e})=>e)),v=o.useThree((({set:e})=>e)),g=o.useThree((({get:e})=>e)),x=o.useThree((({performance:e})=>e)),y=t||f,b=n||("boolean"!=typeof p.connected?p.connected:h.domElement),M=E.useMemo((()=>new u.OrbitControls(y)),[y]);return o.useFrame((()=>{M.enabled&&M.update()})),E.useEffect((()=>{const e=e=>{m(),r&&x.regress(),s&&s(e)};return M.connect(b),M.addEventListener("change",e),i&&M.addEventListener("start",i),l&&M.addEventListener("end",l),()=>{M.removeEventListener("change",e),i&&M.removeEventListener("start",i),l&&M.removeEventListener("end",l),M.dispose()}}),[b,s,i,l,r,M,m]),E.useEffect((()=>{if(e){const e=g().controls;return v({controls:M}),()=>v({controls:e})}}),[e,M]),E.createElement("primitive",w.default({ref:d,object:M,enableDamping:a},c))})),pe=E.forwardRef((({makeDefault:e,camera:t,domElement:r,regress:n,onChange:a,onStart:s,onEnd:i,...l},c)=>{const{invalidate:d,camera:m,gl:f,events:h,set:p,get:v,performance:g,viewport:x}=o.useThree(),y=t||m,b=r||("boolean"!=typeof h.connected?h.connected:f.domElement),M=E.useMemo((()=>new u.TrackballControls(y)),[y]);return o.useFrame((()=>{M.enabled&&M.update()})),E.useEffect((()=>{const e=e=>{d(),n&&g.regress(),a&&a(e)};return M.connect(b),M.addEventListener("change",e),s&&M.addEventListener("start",s),i&&M.addEventListener("end",i),()=>{M.removeEventListener("change",e),s&&M.removeEventListener("start",s),i&&M.removeEventListener("end",i),M.dispose()}}),[b,a,s,i,n,M,d]),E.useEffect((()=>{M.handleResize()}),[x]),E.useEffect((()=>{if(e){const e=v().controls;return p({controls:M}),()=>p({controls:e})}}),[e,M]),E.createElement("primitive",w.default({ref:c,object:M},l))})),ve=E.forwardRef((({makeDefault:e,camera:t,regress:r,domElement:n,onChange:a,onStart:s,onEnd:i,...l},c)=>{const d=o.useThree((({invalidate:e})=>e)),m=o.useThree((({camera:e})=>e)),f=o.useThree((({gl:e})=>e)),h=o.useThree((({events:e})=>e)),p=o.useThree((({set:e})=>e)),v=o.useThree((({get:e})=>e)),g=o.useThree((({performance:e})=>e)),x=t||m,y=n||("boolean"!=typeof h.connected?h.connected:f.domElement),b=E.useMemo((()=>new u.ArcballControls(x)),[x]);return o.useFrame((()=>{b.enabled&&b.update()})),E.useEffect((()=>{const e=e=>{d(),r&&g.regress(),a&&a(e)};return b.connect(y),b.addEventListener("change",e),s&&b.addEventListener("start",s),i&&b.addEventListener("end",i),()=>{b.removeEventListener("change",e),s&&b.removeEventListener("start",s),i&&b.removeEventListener("end",i),b.dispose()}}),[y,a,s,i,r,b,d]),E.useEffect((()=>{if(e){const e=v().controls;return p({controls:b}),()=>p({controls:e})}}),[e,b]),E.createElement("primitive",w.default({ref:c,object:b},l))})),ge=E.forwardRef((({children:e,onChange:t,onMouseDown:r,onMouseUp:n,onObjectChange:a,object:s,...i},l)=>{const c=["enabled","axis","mode","translationSnap","rotationSnap","scaleSnap","space","size","showX","showY","showZ"],{camera:d,...m}=i,f=C.default(m,c),h=R.default(m,c),p=o.useThree((e=>e.controls)),v=o.useThree((({gl:e})=>e)),g=o.useThree((({camera:e})=>e)),x=o.useThree((({invalidate:e})=>e)),y=d||g,[b]=E.useState((()=>new u.TransformControls(y,v.domElement))),S=E.useRef();return E.useLayoutEffect((()=>{s?null==b||b.attach(s instanceof M.Object3D?s:s.current):null==b||b.attach(S.current)}),[s,e,b]),E.useEffect((()=>{if(p){const e=e=>p.enabled=!e.value;return b.addEventListener("dragging-changed",e),()=>b.removeEventListener("dragging-changed",e)}}),[b,p]),E.useEffect((()=>{const e=e=>{x(),t&&t(e)};return null==b||null==b.addEventListener||b.addEventListener("change",e),r&&(null==b||null==b.addEventListener||b.addEventListener("mouseDown",r)),n&&(null==b||null==b.addEventListener||b.addEventListener("mouseUp",n)),a&&(null==b||null==b.addEventListener||b.addEventListener("objectChange",a)),()=>{null==b||null==b.removeEventListener||b.removeEventListener("change",e),r&&(null==b||null==b.removeEventListener||b.removeEventListener("mouseDown",r)),n&&(null==b||null==b.removeEventListener||b.removeEventListener("mouseUp",n)),a&&(null==b||null==b.removeEventListener||b.removeEventListener("objectChange",a))}}),[t,r,n,a,b,x]),b?E.createElement(E.Fragment,null,E.createElement("primitive",w.default({ref:l,dispose:void 0,object:b},f)),E.createElement("group",w.default({ref:S},h),e)):null})),xe=E.forwardRef((({selector:e,onChange:t,onLock:r,onUnlock:n,...a},s)=>{const{camera:i,...l}=a,c=o.useThree((({gl:e})=>e)),d=o.useThree((({camera:e})=>e)),m=o.useThree((({invalidate:e})=>e)),f=i||d,[h]=E.useState((()=>new u.PointerLockControls(f,c.domElement)));return E.useEffect((()=>{const e=e=>{m(),t&&t(e)};return null==h||null==h.addEventListener||h.addEventListener("change",e),r&&(null==h||null==h.addEventListener||h.addEventListener("lock",r)),n&&(null==h||null==h.addEventListener||h.addEventListener("unlock",n)),()=>{null==h||null==h.removeEventListener||h.removeEventListener("change",e),r&&(null==h||null==h.addEventListener||h.addEventListener("lock",r)),n&&(null==h||null==h.addEventListener||h.addEventListener("unlock",n))}}),[t,r,n,h,m]),E.useEffect((()=>{const t=()=>null==h?void 0:h.lock(),r=e?Array.from(document.querySelectorAll(e)):[document];return r.forEach((e=>e&&e.addEventListener("click",t))),()=>{r.forEach((e=>e?e.removeEventListener("click",t):void 0))}}),[h,e]),h?E.createElement("primitive",w.default({ref:s,dispose:void 0,object:h},l)):null})),ye=E.forwardRef(((e,t)=>{const r=o.useThree((({camera:e})=>e)),n=o.useThree((({gl:e})=>e)),[a]=E.useState((()=>new u.FirstPersonControls(r,n.domElement)));return o.useFrame(((e,t)=>{a.update(t)})),a?E.createElement("primitive",w.default({ref:t,object:a},e)):null}));function we(e,t){const r=o.useThree((e=>e.mouse)),[a]=E.useState((()=>{const a=new n.Raycaster;return t&&o.applyProps(a,t,{}),function(t,o){a.setFromCamera(r,e instanceof n.Camera?e:e.current);const s=this.constructor.prototype.raycast.bind(this);s&&s(a,o)}}));return a}const Ee=E.createContext({}),be=()=>E.useContext(Ee),Me=2*Math.PI,Se=new n.Object3D,Te=new n.Matrix4,[Re,Ce]=[new n.Quaternion,new n.Quaternion],_e=new n.Vector3,Le=new n.Vector3,Pe="#f0f0f0",De="#999",ze="black",Be="black",Ue=["Right","Left","Top","Bottom","Front","Back"],Ae=e=>new n.Vector3(...e).multiplyScalar(.38),Fe=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(Ae),ke=[.25,.25,.25],je=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(Ae),Ie=je.map((e=>e.toArray().map((e=>0==e?.5:.25)))),Ve=({hover:e,index:t,font:r="20px Inter var, Arial, sans-serif",faces:a=Ue,color:s=Pe,hoverColor:i=De,textColor:l=ze,strokeColor:u=Be,opacity:c=1})=>{const d=o.useThree((e=>e.gl)),m=E.useMemo((()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const o=e.getContext("2d");return o.fillStyle=s,o.fillRect(0,0,e.width,e.height),o.strokeStyle=u,o.strokeRect(0,0,e.width,e.height),o.font=r,o.textAlign="center",o.fillStyle=l,o.fillText(a[t].toUpperCase(),64,76),new n.CanvasTexture(e)}),[t,r,s,l,u]);return E.createElement("meshLambertMaterial",{map:m,"map-anisotropy":d.capabilities.getMaxAnisotropy()||1,attachArray:"material",color:e?i:"white",transparent:!0,opacity:c})},Oe=e=>{const{tweenCamera:t,raycast:r}=be(),[n,o]=E.useState(null);return E.createElement("mesh",{raycast:r,onPointerOut:e=>{e.stopPropagation(),o(null)},onPointerMove:e=>{e.stopPropagation(),o(Math.floor(e.faceIndex/2))},onClick:e.onClick||(e=>{e.stopPropagation(),t(e.face.normal)})},[...Array(6)].map(((t,r)=>E.createElement(Ve,w.default({key:r,index:r,hover:n===r},e)))),E.createElement("boxGeometry",null))},Ge=({onClick:e,dimensions:t,position:r,hoverColor:n=De})=>{const{tweenCamera:o,raycast:a}=be(),[s,i]=E.useState(!1);return E.createElement("mesh",{scale:1.01,position:r,raycast:a,onPointerOver:e=>{e.stopPropagation(),i(!0)},onPointerOut:e=>{e.stopPropagation(),i(!1)},onClick:e||(e=>{e.stopPropagation(),o(r)})},E.createElement("meshBasicMaterial",{color:s?n:"white",transparent:!0,opacity:.6,visible:s}),E.createElement("boxGeometry",{args:t}))};function We({scale:e=[.8,.05,.05],color:t,rotation:r}){return E.createElement("group",{rotation:r},E.createElement("mesh",{position:[.4,0,0]},E.createElement("boxGeometry",{args:e}),E.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function Ne({onClick:e,font:t,disabled:r,arcStyle:a,label:s,labelColor:i,axisHeadScale:l=1,...u}){const c=o.useThree((e=>e.gl)),d=E.useMemo((()=>{const e=document.createElement("canvas");e.width=64,e.height=64;const r=e.getContext("2d");return r.beginPath(),r.arc(32,32,16,0,2*Math.PI),r.closePath(),r.fillStyle=a,r.fill(),s&&(r.font=t,r.textAlign="center",r.fillStyle=i,r.fillText(s,32,41)),new n.CanvasTexture(e)}),[a,s,i,t]),[m,f]=E.useState(!1),h=(s?1:.75)*(m?1.2:1)*l;return E.createElement("sprite",w.default({scale:h,onPointerOver:r?void 0:e=>{e.stopPropagation(),f(!0)},onPointerOut:r?void 0:e||(e=>{e.stopPropagation(),f(!1)})},u),E.createElement("spriteMaterial",{map:d,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}function He(e,{path:t}){const[r]=o.useLoader(n.CubeTextureLoader,[e],(e=>e.setPath(t)));return r}function qe(e){return o.useLoader(u.FBXLoader,e)}He.preload=(e,{path:t})=>o.useLoader.preload(n.CubeTextureLoader,[e],(e=>e.setPath(t))),qe.preload=e=>o.useLoader.preload(u.FBXLoader,e),qe.clear=e=>o.useLoader.clear(u.FBXLoader,e);let $e=null;function Ze(e,t,r){return n=>{r&&r(n),e&&($e||($e=new u.DRACOLoader),$e.setDecoderPath("string"==typeof e?e:"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),n.setDRACOLoader($e)),t&&n.setMeshoptDecoder("function"==typeof u.MeshoptDecoder?u.MeshoptDecoder():u.MeshoptDecoder)}}function Xe(e,t=!0,r=!0,n){return o.useLoader(u.GLTFLoader,e,Ze(t,r,n))}function Ye(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function Qe(e,r,n){const a=o.useThree((({gl:e})=>e)),s=o.useThree((({size:e})=>e)),i=t.useMemo((()=>a.getPixelRatio()),[a]),l="number"==typeof e?e:s.width*i,u="number"==typeof r?r:s.height*i,c=("number"==typeof e?n:e)||{},d=t.useMemo((()=>{const{multisample:e,samples:t,...r}=c;let n;return e&&a.capabilities.isWebGL2?(n=new M.WebGLMultisampleRenderTarget(l,u,r),t&&(n.samples=t)):n=new M.WebGLRenderTarget(l,u,r),n}),[]);return t.useEffect((()=>{d.setSize(l,u)}),[d,l,u]),t.useEffect((()=>()=>d.dispose()),[]),d}Xe.preload=(e,t=!0,r=!0,n)=>o.useLoader.preload(u.GLTFLoader,e,Ze(t,r,n)),Xe.clear=e=>o.useLoader.clear(u.GLTFLoader,e);const Ke=E.forwardRef((({children:e,curve:t},r)=>{const[n,o]=E.useState(),a=E.useRef(),s=E.useRef();return E.useImperativeHandle(r,(()=>({moveAlongCurve:e=>{var t;null==(t=s.current)||t.moveAlongCurve(e)}}))),E.useEffect((()=>{!s.current&&a.current&&r&&(s.current=new u.Flow(a.current),o(s.current.object3D))}),[e,r]),E.useEffect((()=>{var e;a.current&&t&&(null==(e=s.current)||e.updateCurve(0,t))}),[t]),n?E.createElement("primitive",{object:n}):E.cloneElement(E.Children.only(e),{ref:a})}));class Je extends n.MeshPhysicalMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`\n      uniform float time;\n      uniform float radius;\n      uniform float distort;\n      #define GLSLIFY 1\nvec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n        float updateTime = time / 50.0;\n        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));\n        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));\n        ")}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}const et=E.forwardRef((({speed:e=1,...t},r)=>{const[n]=E.useState((()=>new Je));return o.useFrame((t=>n&&(n.time=t.clock.getElapsedTime()*e))),E.createElement("primitive",w.default({dispose:void 0,object:n,ref:r,attach:"material"},t))}));class tt extends n.MeshStandardMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`\n      uniform float time;\n      uniform float factor;\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","float theta = sin( time + position.y ) / 2.0 * factor;\n        float c = cos( theta );\n        float s = sin( theta );\n        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );\n        vec3 transformed = vec3( position ) * m;\n        vNormal = vNormal * m;")}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}const rt=E.forwardRef((({speed:e=1,...t},r)=>{const[n]=E.useState((()=>new tt));return o.useFrame((t=>n&&(n.time=t.clock.getElapsedTime()*e))),E.createElement("primitive",w.default({dispose:void 0,object:n,ref:r,attach:"material"},t))}));class nt extends n.ShaderMaterial{constructor(e=new n.Vector2){super({uniforms:{inputBuffer:new n.Uniform(null),depthBuffer:new n.Uniform(null),resolution:new n.Uniform(new n.Vector2),texelSize:new n.Uniform(new n.Vector2),halfTexelSize:new n.Uniform(new n.Vector2),kernel:new n.Uniform(0),scale:new n.Uniform(1),cameraNear:new n.Uniform(0),cameraFar:new n.Uniform(1),minDepthThreshold:new n.Uniform(0),maxDepthThreshold:new n.Uniform(1),depthScale:new n.Uniform(0),depthToBlurRatioBias:new n.Uniform(.25)},fragmentShader:"#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n        }",vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:n.NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class ot{constructor({gl:e,resolution:t,width:r=500,height:o=500,minDepthThreshold:a=0,maxDepthThreshold:s=1,depthScale:i=0,depthToBlurRatioBias:l=.25}){this.renderToScreen=!1,this.renderTargetA=new n.WebGLRenderTarget(t,t,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,stencilBuffer:!1,depthBuffer:!1,encoding:e.outputEncoding}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new nt,this.convolutionMaterial.setTexelSize(1/r,1/o),this.convolutionMaterial.setResolution(new n.Vector2(r,o)),this.scene=new n.Scene,this.camera=new n.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=a,this.convolutionMaterial.uniforms.maxDepthThreshold.value=s,this.convolutionMaterial.uniforms.depthScale.value=i,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=l,this.convolutionMaterial.defines.USE_DEPTH=i>0;const u=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),c=new Float32Array([0,0,2,0,0,2]),d=new n.BufferGeometry;d.setAttribute("position",new n.BufferAttribute(u,3)),d.setAttribute("uv",new n.BufferAttribute(c,2)),this.screen=new n.Mesh(d,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,r){const n=this.scene,o=this.camera,a=this.renderTargetA,s=this.renderTargetB;let i=this.convolutionMaterial,l=i.uniforms;l.depthBuffer.value=t.depthTexture;const u=i.kernel;let c,d,m,f=t;for(d=0,m=u.length-1;d<m;++d)c=0==(1&d)?a:s,l.kernel.value=u[d],l.inputBuffer.value=f.texture,e.setRenderTarget(c),e.render(n,o),f=c;l.kernel.value=u[d],l.inputBuffer.value=f.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(n,o)}}class at extends n.MeshStandardMaterial{constructor(e={}){super(e),this._debug={value:0},this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.debug=this._debug,e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;     \n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform int debug;\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;        \n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n    \n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n      \n      vec4 merge = base;\n      \n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n  \n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n      \n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);           \n      diffuseColor = sRGBToLinear(diffuseColor);\n      \n      if (debug == 1) {\n        diffuseColor = sRGBToLinear(vec4(vec3(depthFactor), 1.0));\n      }\n      if (debug == 2) {\n        diffuseColor = sRGBToLinear(vec4(vec3(blurFactor), 1.0));\n      }\n      if (debug == 3) {\n        diffuseColor = sRGBToLinear(texture2DProj(tDiffuse, new_vUv));\n      }\n      if (debug == 4) {\n        diffuseColor = sRGBToLinear(texture2DProj(tDiffuseBlur, new_vUv));\n      }\n      ")}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get debug(){return this._debug.value}set debug(e){this._debug.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}o.extend({MeshReflectorMaterialImpl:at});const st=E.forwardRef((({mixBlur:e=0,mixStrength:t=1,resolution:r=256,blur:a=[0,0],minDepthThreshold:s=.9,maxDepthThreshold:i=1,depthScale:l=0,depthToBlurRatioBias:u=.25,mirror:c=0,debug:d=0,distortion:m=1,mixContrast:f=1,distortionMap:h,...p},v)=>{const g=o.useThree((({gl:e})=>e)),x=o.useThree((({camera:e})=>e)),y=o.useThree((({scene:e})=>e)),b=(a=Array.isArray(a)?a:[a,a])[0]+a[1]>0,M=E.useRef(null),[S]=E.useState((()=>new n.Plane)),[R]=E.useState((()=>new n.Vector3)),[C]=E.useState((()=>new n.Vector3)),[_]=E.useState((()=>new n.Vector3)),[L]=E.useState((()=>new n.Matrix4)),[P]=E.useState((()=>new n.Vector3(0,0,-1))),[D]=E.useState((()=>new n.Vector4)),[z]=E.useState((()=>new n.Vector3)),[B]=E.useState((()=>new n.Vector3)),[U]=E.useState((()=>new n.Vector4)),[A]=E.useState((()=>new n.Matrix4)),[F]=E.useState((()=>new n.PerspectiveCamera)),k=E.useCallback((()=>{var e;const t=M.current.parent||(null==(e=M.current)?void 0:e.__r3f.parent);if(!t)return;if(C.setFromMatrixPosition(t.matrixWorld),_.setFromMatrixPosition(x.matrixWorld),L.extractRotation(t.matrixWorld),R.set(0,0,1),R.applyMatrix4(L),z.subVectors(C,_),z.dot(R)>0)return;z.reflect(R).negate(),z.add(C),L.extractRotation(x.matrixWorld),P.set(0,0,-1),P.applyMatrix4(L),P.add(_),B.subVectors(C,P),B.reflect(R).negate(),B.add(C),F.position.copy(z),F.up.set(0,1,0),F.up.applyMatrix4(L),F.up.reflect(R),F.lookAt(B),F.far=x.far,F.updateMatrixWorld(),F.projectionMatrix.copy(x.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(F.projectionMatrix),A.multiply(F.matrixWorldInverse),A.multiply(t.matrixWorld),S.setFromNormalAndCoplanarPoint(R,C),S.applyMatrix4(F.matrixWorldInverse),D.set(S.normal.x,S.normal.y,S.normal.z,S.constant);const r=F.projectionMatrix;U.x=(Math.sign(D.x)+r.elements[8])/r.elements[0],U.y=(Math.sign(D.y)+r.elements[9])/r.elements[5],U.z=-1,U.w=(1+r.elements[10])/r.elements[14],D.multiplyScalar(2/D.dot(U)),r.elements[2]=D.x,r.elements[6]=D.y,r.elements[10]=D.z+1,r.elements[14]=D.w}),[]),[j,I,V,O]=E.useMemo((()=>{const o={minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBFormat,encoding:g.outputEncoding},p=new n.WebGLRenderTarget(r,r,o);p.depthBuffer=!0,p.depthTexture=new n.DepthTexture(r,r),p.depthTexture.format=n.DepthFormat,p.depthTexture.type=n.UnsignedShortType;const v=new n.WebGLRenderTarget(r,r,o);return[p,v,new ot({gl:g,resolution:r,width:a[0],height:a[1],minDepthThreshold:s,maxDepthThreshold:i,depthScale:l,depthToBlurRatioBias:u}),{mirror:c,textureMatrix:A,mixBlur:e,tDiffuse:p.texture,tDepth:p.depthTexture,tDiffuseBlur:v.texture,hasBlur:b,mixStrength:t,minDepthThreshold:s,maxDepthThreshold:i,depthScale:l,depthToBlurRatioBias:u,transparent:!0,debug:d,distortion:m,distortionMap:h,mixContrast:f,"defines-USE_BLUR":b?"":void 0,"defines-USE_DEPTH":l>0?"":void 0,"defines-USE_DISTORTION":h?"":void 0}]}),[g,a,A,r,c,b,e,t,s,i,l,u,d,m,h,f]);return o.useFrame((()=>{var e;const t=M.current.parent||(null==(e=M.current)?void 0:e.__r3f.parent);if(!t)return;t.visible=!1;const r=g.xr.enabled,n=g.shadowMap.autoUpdate;k(),g.xr.enabled=!1,g.shadowMap.autoUpdate=!1,g.setRenderTarget(j),g.state.buffers.depth.setMask(!0),g.autoClear||g.clear(),g.render(y,F),b&&V.render(g,j,I),g.xr.enabled=r,g.shadowMap.autoUpdate=n,t.visible=!0,g.setRenderTarget(null)})),E.createElement("meshReflectorMaterialImpl",w.default({attach:"material",key:"key"+O["defines-USE_BLUR"]+O["defines-USE_DEPTH"]+O["defines-USE_DISTORTION"],ref:T.default([M,v])},O,p))}));class it extends M.ShaderMaterial{constructor(){super({transparent:!0,uniforms:{size:{value:1}},vertexShader:M.ShaderLib.points.vertexShader,fragmentShader:"\n      varying vec3 vColor;\n      void main() {\n        vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n        float r = dot(cxy, cxy);\n        float delta = fwidth(r);\n        vec3 color = vColor;\n        #ifdef TONE_MAPPING\n          color = toneMapping(color);\n        #endif\n        gl_FragColor = linearToOutputTexel(vec4(color, 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r)));\n      }",vertexColors:!0})}get scale(){return this.uniforms.size.value}set scale(e){this.uniforms.size.value=e}}const lt=E.forwardRef(((e,t)=>{const[r]=E.useState((()=>new it));return E.createElement("primitive",w.default({object:r,ref:t,attach:"material"},e))}));let ut=!1;function ct(e){const t=e+"BufferGeometry";return E.forwardRef((({args:e,children:r,...n},o)=>E.createElement("mesh",w.default({ref:o},n),E.createElement(t,{attach:"geometry",args:e}),r)))}const dt=ct("box"),mt=ct("circle"),ft=ct("cone"),ht=ct("cylinder"),pt=ct("sphere"),vt=ct("plane"),gt=ct("tube"),xt=ct("torus"),yt=ct("torusKnot"),wt=ct("tetrahedron"),Et=ct("ring"),bt=ct("polyhedron"),Mt=ct("icosahedron"),St=ct("octahedron"),Tt=ct("dodecahedron"),Rt=ct("extrude"),Ct=ct("lathe"),_t=1e-5;const Lt=E.forwardRef((function({args:[e=1,t=1,r=1]=[],radius:o=.05,smoothness:a=4,children:s,...i},l){const u=E.useMemo((()=>function(e,t,r){const o=new n.Shape,a=r-_t;return o.absarc(_t,_t,_t,-Math.PI/2,-Math.PI,!0),o.absarc(_t,t-2*a,_t,Math.PI,Math.PI/2,!0),o.absarc(e-2*a,t-2*a,_t,Math.PI/2,0,!0),o.absarc(e-2*a,_t,_t,0,-Math.PI/2,!0),o}(e,t,o)),[e,t,o]),c=E.useMemo((()=>({depth:r-2*o,bevelEnabled:!0,bevelSegments:2*a,steps:1,bevelSize:o-_t,bevelThickness:o,curveSegments:a})),[r,o,a]),d=E.useRef();return E.useLayoutEffect((()=>{d.current&&d.current.center()}),[u,c]),E.createElement("mesh",w.default({ref:l},i),E.createElement("extrudeBufferGeometry",{attach:"geometry",ref:d,args:[u,c]}),s)}));function Pt(){const e=new M.BufferGeometry,t=new Float32Array([-1,-1,3,-1,-1,3]);return e.setAttribute("position",new M.BufferAttribute(t,2)),e}const Dt=E.forwardRef((function({children:e,...t},r){const n=E.useMemo(Pt,[]);return E.createElement("mesh",w.default({ref:r,geometry:n,frustumCulled:!1},t),e)})),zt=E.forwardRef((function({children:e,alignTop:t,...r},o){const a=E.useRef(null),s=E.useRef(null);return E.useLayoutEffect((()=>{a.current.position.set(0,0,0),a.current.updateWorldMatrix(!0,!0);const e=(new n.Box3).setFromObject(s.current),r=new n.Vector3,o=new n.Sphere,i=e.max.y-e.min.y;e.getCenter(r),e.getBoundingSphere(o),a.current.position.set(-r.x,-r.y+(t?i/2:0),-r.z)}),[e]),E.createElement("group",w.default({ref:o},r),E.createElement("group",{ref:a},E.createElement("group",{ref:s},e)))})),Bt=e=>e&&e.isOrthographicCamera,Ut=E.createContext(null);const At=E.forwardRef((({intensity:e=1,decay:t,decayRate:r=.65,maxYaw:n=.1,maxPitch:a=.1,maxRoll:s=.1,yawFrequency:i=.1,pitchFrequency:l=.1,rollFrequency:c=.1,controls:d},m)=>{const f=o.useThree((e=>e.camera)),h=o.useThree((e=>e.controls)),p=E.useRef(e),v=E.useRef(f.rotation.clone()),[g]=E.useState((()=>new u.SimplexNoise)),[x]=E.useState((()=>new u.SimplexNoise)),[y]=E.useState((()=>new u.SimplexNoise)),w=()=>{(p.current<0||p.current>1)&&(p.current=p.current<0?0:1)};return E.useImperativeHandle(m,(()=>({getIntensity:()=>p.current,setIntensity:e=>{p.current=e,w()}})),[]),E.useEffect((()=>{const e=h||(null==d?void 0:d.current),t=()=>{v.current=f.rotation.clone()};return null==e||e.addEventListener("change",t),()=>{null==e||e.removeEventListener("change",t)}}),[d,h]),o.useFrame((({clock:e},o)=>{const u=Math.pow(p.current,2),d=n*u*g.noise(e.elapsedTime*i,1),m=a*u*x.noise(e.elapsedTime*l,1),h=s*u*y.noise(e.elapsedTime*c,1);f.rotation.set(v.current.x+m,v.current.y+d,v.current.z+h),t&&p.current>0&&(p.current-=r*o,w())})),null}));const Ft={sunset:"venice_sunset_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",night:"dikhololo_night_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr",forest:"forest_slope_1k.hdr",apartment:"lebombo_1k.hdr",studio:"studio_small_03_1k.hdr",city:"potsdamer_platz_1k.hdr",park:"rooitou_park_1k.hdr",lobby:"st_fagans_interior_1k.hdr"};function kt({background:e=!1,files:t=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:r="",preset:a,scene:s,extensions:i}){if(a){if(!(a in Ft))throw new Error("Preset must be one of: "+Object.keys(Ft).join(", "));t=Ft[a],r="https://rawcdn.githack.com/pmndrs/drei-assets/aa3600359ba664d546d05821bcbca42013587df2/hdri/"}const l=o.useThree((({scene:e})=>e)),c=o.useThree((({gl:e})=>e)),d=Array.isArray(t),m=d?n.CubeTextureLoader:u.RGBELoader,f=o.useLoader(m,d?[t]:t,(e=>{e.setPath(r),i&&i(e)})),h=d?f[0]:f,v=p.useAsset((()=>new Promise((e=>{const t=new n.PMREMGenerator(c),r=function(e,t,r){return r?(t.compileEquirectangularShader(),t.fromCubemap(e).texture):t.fromEquirectangular(e).texture}(h,t,d);t.dispose(),e(r)}))),h);return E.useLayoutEffect((()=>{const t=s?s.background:l.background,r=s?s.environment:l.environment;return s?(s.environment=v,e&&(s.background=v)):(l.environment=v,e&&(l.background=v)),()=>{s?(s.environment=r,s.background=t):(l.environment=r,l.background=t),p.useAsset.clear(h),v.dispose()}}),[v,e,s]),null}const jt=E.forwardRef((({scale:e,frames:t=1/0,opacity:r=1,width:n=1,height:a=1,blur:s=1,far:i=10,resolution:l=256,...c},d)=>{const m=o.useThree((({scene:e})=>e)),f=o.useThree((({gl:e})=>e)),h=E.useRef();n*=Array.isArray(e)?e[0]:e||1,a*=Array.isArray(e)?e[1]:e||1;const[p,v,g,x,y,b,S]=E.useMemo((()=>{const e=new M.WebGLRenderTarget(l,l),t=new M.WebGLRenderTarget(l,l);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;const r=new M.PlaneBufferGeometry(n,a).rotateX(Math.PI/2),o=new M.Mesh(r),s=new M.MeshDepthMaterial;s.depthTest=s.depthWrite=!1,s.onBeforeCompile=e=>e.fragmentShader=e.fragmentShader.replace("1.0 - fragCoordZ ), opacity );","0.0 ), ( 1.0 - fragCoordZ ) * 1.0 );");const i=new M.ShaderMaterial(u.HorizontalBlurShader),c=new M.ShaderMaterial(u.VerticalBlurShader);return c.depthTest=i.depthTest=!1,[e,r,s,o,i,c,t]}),[l,n,a,e]);let T=0;return o.useFrame((()=>{if(h.current&&(t===1/0||T<t)){const e=m.background;m.background=null,m.overrideMaterial=g,f.setRenderTarget(p),f.render(m,h.current),m.overrideMaterial=null,x.material=y,x.material.uniforms.tDiffuse.value=p.texture,y.uniforms.h.value=s/256,f.setRenderTarget(S),f.render(x,h.current),x.material=b,x.material.uniforms.tDiffuse.value=S.texture,b.uniforms.v.value=s/256,f.setRenderTarget(p),f.render(x,h.current),f.setRenderTarget(null),m.background=e,T++}})),E.createElement("group",w.default({"rotation-x":Math.PI/2},c,{ref:d}),E.createElement("mesh",{geometry:v,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},E.createElement("meshBasicMaterial",{map:p.texture,transparent:!0,opacity:r})),E.createElement("orthographicCamera",{ref:h,args:[-n/2,n/2,a/2,-a/2,0,i]}))})),It={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};const Vt=e=>0===e?0:Math.pow(2,10*e-10);const Ot=E.forwardRef((({fog:e=!1,colorStop:t=0,color:r="black",opacity:o=.5,...a},s)=>{const i=E.useMemo((()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const o=e.getContext("2d"),a=o.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);return a.addColorStop(t,new n.Color(r).getStyle()),a.addColorStop(1,"rgba(0,0,0,0)"),o.fillStyle=a,o.fillRect(0,0,e.width,e.height),e}),[r,t]);return E.createElement("mesh",w.default({ref:s},a),E.createElement("planeBufferGeometry",{attach:"geometry",args:[1,1]}),E.createElement("meshBasicMaterial",{attach:"material",transparent:!0,opacity:o,fog:e},E.createElement("canvasTexture",{attach:"map",args:[i]})))}));o.extend({MeshReflectorMaterial:at});const Gt=E.forwardRef((({mixBlur:e=0,mixStrength:t=.5,resolution:r=256,blur:a=[0,0],args:s=[1,1],minDepthThreshold:i=.9,maxDepthThreshold:l=1,depthScale:u=0,depthToBlurRatioBias:c=.25,mirror:d=0,children:m,debug:f=0,distortion:h=1,mixContrast:p=1,distortionMap:v,...g},x)=>{E.useEffect((()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")}),[]);const y=o.useThree((({gl:e})=>e)),b=o.useThree((({camera:e})=>e)),M=o.useThree((({scene:e})=>e)),S=(a=Array.isArray(a)?a:[a,a])[0]+a[1]>0,R=E.useRef(null),[C]=E.useState((()=>new n.Plane)),[_]=E.useState((()=>new n.Vector3)),[L]=E.useState((()=>new n.Vector3)),[P]=E.useState((()=>new n.Vector3)),[D]=E.useState((()=>new n.Matrix4)),[z]=E.useState((()=>new n.Vector3(0,0,-1))),[B]=E.useState((()=>new n.Vector4)),[U]=E.useState((()=>new n.Vector3)),[A]=E.useState((()=>new n.Vector3)),[F]=E.useState((()=>new n.Vector4)),[k]=E.useState((()=>new n.Matrix4)),[j]=E.useState((()=>new n.PerspectiveCamera)),I=E.useCallback((()=>{if(L.setFromMatrixPosition(R.current.matrixWorld),P.setFromMatrixPosition(b.matrixWorld),D.extractRotation(R.current.matrixWorld),_.set(0,0,1),_.applyMatrix4(D),U.subVectors(L,P),U.dot(_)>0)return;U.reflect(_).negate(),U.add(L),D.extractRotation(b.matrixWorld),z.set(0,0,-1),z.applyMatrix4(D),z.add(P),A.subVectors(L,z),A.reflect(_).negate(),A.add(L),j.position.copy(U),j.up.set(0,1,0),j.up.applyMatrix4(D),j.up.reflect(_),j.lookAt(A),j.far=b.far,j.updateMatrixWorld(),j.projectionMatrix.copy(b.projectionMatrix),k.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),k.multiply(j.projectionMatrix),k.multiply(j.matrixWorldInverse),k.multiply(R.current.matrixWorld),C.setFromNormalAndCoplanarPoint(_,L),C.applyMatrix4(j.matrixWorldInverse),B.set(C.normal.x,C.normal.y,C.normal.z,C.constant);const e=j.projectionMatrix;F.x=(Math.sign(B.x)+e.elements[8])/e.elements[0],F.y=(Math.sign(B.y)+e.elements[9])/e.elements[5],F.z=-1,F.w=(1+e.elements[10])/e.elements[14],B.multiplyScalar(2/B.dot(F)),e.elements[2]=B.x,e.elements[6]=B.y,e.elements[10]=B.z+1,e.elements[14]=B.w}),[]),[V,O,G,W]=E.useMemo((()=>{const o={minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBFormat,encoding:y.outputEncoding},s=new n.WebGLRenderTarget(r,r,o);s.depthBuffer=!0,s.depthTexture=new n.DepthTexture(r,r),s.depthTexture.format=n.DepthFormat,s.depthTexture.type=n.UnsignedShortType;const m=new n.WebGLRenderTarget(r,r,o);return[s,m,new ot({gl:y,resolution:r,width:a[0],height:a[1],minDepthThreshold:i,maxDepthThreshold:l,depthScale:u,depthToBlurRatioBias:c}),{mirror:d,textureMatrix:k,mixBlur:e,tDiffuse:s.texture,tDepth:s.depthTexture,tDiffuseBlur:m.texture,hasBlur:S,mixStrength:t,minDepthThreshold:i,maxDepthThreshold:l,depthScale:u,depthToBlurRatioBias:c,transparent:!0,debug:f,distortion:h,distortionMap:v,mixContrast:p,"defines-USE_BLUR":S?"":void 0,"defines-USE_DEPTH":u>0?"":void 0,"defines-USE_DISTORTION":v?"":void 0}]}),[y,a,k,r,d,S,e,t,i,l,u,c,f,h,v,p]);return o.useFrame((()=>{if(null==R||!R.current)return;R.current.visible=!1;const e=y.xr.enabled,t=y.shadowMap.autoUpdate;I(),y.xr.enabled=!1,y.shadowMap.autoUpdate=!1,y.setRenderTarget(V),y.state.buffers.depth.setMask(!0),y.autoClear||y.clear(),y.render(M,j),S&&G.render(y,V,O),y.xr.enabled=e,y.shadowMap.autoUpdate=t,R.current.visible=!0,y.setRenderTarget(null)})),E.createElement("mesh",w.default({ref:T.default([R,x])},g),E.createElement("planeBufferGeometry",{args:s}),m?m("meshReflectorMaterial",W):E.createElement("meshReflectorMaterial",W))}));class Wt extends n.ShaderMaterial{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new n.Vector3(0,0,0)},lightColor:{value:new n.Color("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new n.Vector2(0,0)}},transparent:!0,depthWrite:!1,vertexShader:"\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform vec3 spotPosition;\n      uniform float attenuation;      \n\n      void main() {\n        // compute intensity\n        vNormal = normalize( normalMatrix * normal );\n        vec4 worldPosition\t= modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n        vec4 viewPosition = viewMatrix * worldPosition;\n        vViewZ = viewPosition.z;\n        float intensity\t= distance(worldPosition.xyz, spotPosition) / attenuation;\n        intensity\t= 1.0 - clamp(intensity, 0.0, 1.0);\n        vIntensity = intensity;        \n        // set gl_Position\n        gl_Position\t= projectionMatrix * viewPosition;\n\n      }",fragmentShader:"\n      #include <packing>\n\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      uniform vec3 lightColor;\n      uniform vec3 spotPosition;\n      uniform float attenuation;\n      uniform float anglePower;\n      uniform sampler2D depth;\n      uniform vec2 resolution;\n      uniform float cameraNear;\n      uniform float cameraFar;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform float opacity;\n\n      float readDepth( sampler2D depthSampler, vec2 coord ) {\n        float fragCoordZ = texture2D( depthSampler, coord ).x;\n        float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\n        return viewZ;\n      }\n\n      void main() {\n        float d = 1.0;\n        bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;\n        if (isSoft) {\n          vec2 sUv = gl_FragCoord.xy / resolution;\n          d = readDepth(depth, sUv);\n        }\n        float intensity = vIntensity;\n        vec3 normal\t= vec3(vNormal.x, vNormal.y, abs(vNormal.z));\n        float angleIntensity\t= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );\n        intensity\t*= angleIntensity;\n        // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry\n        if (isSoft) {\n          intensity\t*= smoothstep(0., 1., vViewZ - d);\n        }\n        gl_FragColor = vec4(lightColor, intensity * opacity);\n      }"})}}const Nt=new n.Vector3,Ht=E.forwardRef((({opacity:e=1,radiusTop:t,radiusBottom:r,depthBuffer:a,color:s="white",distance:i=5,angle:l=.15,attenuation:u=5,anglePower:c=5,...d},m)=>{const f=E.useRef(null),h=o.useThree((e=>e.size)),p=o.useThree((e=>e.camera)),v=o.useThree((e=>e.viewport.dpr)),[g]=E.useState((()=>new Wt));t=void 0===t?.1:t,r=void 0===r?7*l:r,o.useFrame((()=>{g.uniforms.spotPosition.value.copy(f.current.getWorldPosition(Nt)),f.current.lookAt(f.current.parent.target.getWorldPosition(Nt))}));const x=E.useMemo((()=>{const e=new n.CylinderGeometry(t,r,i,128,64,!0);return e.applyMatrix4((new n.Matrix4).makeTranslation(0,-i/2,0)),e.applyMatrix4((new n.Matrix4).makeRotationX(-Math.PI/2)),e}),[l,i,t,r]);return E.createElement("spotLight",w.default({ref:m,angle:l,color:s,distance:i},d),E.createElement("mesh",{ref:f,geometry:x,raycast:()=>null},E.createElement("primitive",{object:g,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":s,"uniforms-attenuation-value":u,"uniforms-anglePower-value":c,"uniforms-depth-value":a,"uniforms-cameraNear-value":p.near,"uniforms-cameraFar-value":p.far,"uniforms-resolution-value":a?[h.width*v,h.height*v]:[0,0]})))}));function qt(e,t,r=new n.Vector3){const o=Math.PI*(e-.5),a=2*Math.PI*(t-.5);return r.x=Math.cos(a),r.y=Math.sin(o),r.z=Math.sin(a),r}const $t=E.forwardRef((({inclination:e=.6,azimuth:t=.1,distance:r=1e3,mieCoefficient:o=.005,mieDirectionalG:a=.8,rayleigh:s=.5,turbidity:i=10,sunPosition:l=qt(e,t),...c},d)=>{const m=E.useMemo((()=>(new n.Vector3).setScalar(r)),[r]),[f]=E.useState((()=>new u.Sky));return E.createElement("primitive",w.default({dispose:void 0,object:f,ref:d,"material-uniforms-mieCoefficient-value":o,"material-uniforms-mieDirectionalG-value":a,"material-uniforms-rayleigh-value":s,"material-uniforms-sunPosition-value":l,"material-uniforms-turbidity-value":i,scale:m},c))}));class Zt extends n.ShaderMaterial{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:"\n      uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(mvPosition.x + 2.0 * time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:"\n      uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n      }"})}}const Xt=e=>(new n.Vector3).setFromSpherical(new n.Spherical(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),Yt=E.forwardRef((({radius:e=100,depth:t=50,count:r=5e3,saturation:a=0,factor:s=4,fade:i=!1},l)=>{const u=E.useRef(),[c,d,m]=E.useMemo((()=>{const o=[],i=[],l=Array.from({length:r},(()=>(.5+.5*Math.random())*s)),u=new n.Color;let c=e+t;const d=t/r;for(let e=0;e<r;e++)c-=d*Math.random(),o.push(...Xt(c).toArray()),u.setHSL(e/r,a,.9),i.push(u.r,u.g,u.b);return[new Float32Array(o),new Float32Array(i),new Float32Array(l)]}),[r,t,s,e,a]);o.useFrame((e=>u.current&&(u.current.uniforms.time.value=e.clock.getElapsedTime())));const[f]=E.useState((()=>new Zt));return E.createElement("points",{ref:l},E.createElement("bufferGeometry",{attach:"geometry"},E.createElement("bufferAttribute",{attachObject:["attributes","position"],args:[c,3]}),E.createElement("bufferAttribute",{attachObject:["attributes","color"],args:[d,3]}),E.createElement("bufferAttribute",{attachObject:["attributes","size"],args:[m,1]})),E.createElement("primitive",{dispose:void 0,ref:u,object:f,attach:"material",blending:n.AdditiveBlending,"uniforms-fade-value":i,transparent:!0,vertexColors:!0}))}));const Qt=new M.Matrix4,Kt=new M.Matrix4,Jt=[],er=new M.Mesh;class tr extends M.Group{constructor(){super(),this.color=new M.Color("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){const r=this.instance.current;if(!r)return;if(!r.geometry||!r.material)return;er.geometry=r.geometry;const n=r.matrixWorld;let o=r.userData.instances.indexOf(this.instanceKey);if(-1!==o){r.getMatrixAt(o,Qt),Kt.multiplyMatrices(n,Qt),er.matrixWorld=Kt,er.raycast(e,Jt);for(let e=0,r=Jt.length;e<r;e++){const r=Jt[e];r.instanceId=o,r.object=this,t.push(r)}Jt.length=0}}}let rr,nr;const or=E.createContext(null),ar=new M.Matrix4,sr=new M.Vector3,ir=new M.Color,lr=E.forwardRef((({children:e,range:t,limit:r=1e3,...n},a)=>{const s=E.useRef(null),[i,l]=E.useState([]),[[u,c,d]]=E.useState((()=>[new Float32Array(3*r),Float32Array.from({length:3*r},(()=>1)),Float32Array.from({length:r},(()=>1))]));E.useLayoutEffect((()=>{s.current.geometry.drawRange.count=Math.min(r,void 0!==t?t:r,i.length)}),[i,t]),E.useEffect((()=>{s.current.geometry.attributes.position.needsUpdate=!0})),o.useFrame((()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),ar.copy(s.current.matrixWorld).invert(),rr=0;rr<i.length;rr++)nr=i[rr].current,nr.getWorldPosition(sr).applyMatrix4(ar),sr.x===u[3*rr]&&sr.y===u[3*rr+1]&&sr.z===u[3*rr+2]||(sr.toArray(u,3*rr),s.current.geometry.attributes.position.needsUpdate=!0,nr.matrixWorldNeedsUpdate=!0),nr.color.equals(ir.fromArray(c,3*rr))||(nr.color.toArray(c,3*rr),s.current.geometry.attributes.color.needsUpdate=!0),nr.size!==d[rr]&&(d.set([nr.size],rr),s.current.geometry.attributes.size.needsUpdate=!0)}));const m=E.useMemo((()=>{const e={};for(rr=0;rr<i.length;rr++){var t;Object.assign(e,null==(t=i[rr].current)?void 0:t.__r3f.handlers)}return Object.keys(e).reduce(((e,t)=>({...e,[t]:e=>{var r,n,o;const a=null==(r=i[e.index])?void 0:r.current;return null==a||null==(n=a.__r3f)||null==(o=n.handlers)?void 0:o[t]({...e,object:a})}})),{})}),[e,i]),f=E.useMemo((()=>({subscribe:e=>(l((t=>[...t,e])),()=>l((t=>t.filter((t=>t.current!==e.current)))))})),[]);return E.createElement("points",w.default({matrixAutoUpdate:!1,ref:T.default([a,s])},m,n),E.createElement("bufferGeometry",null,E.createElement("bufferAttribute",{attachObject:["attributes","position"],count:u.length/3,array:u,itemSize:3,usage:M.DynamicDrawUsage}),E.createElement("bufferAttribute",{attachObject:["attributes","color"],count:c.length/3,array:c,itemSize:3,usage:M.DynamicDrawUsage}),E.createElement("bufferAttribute",{attachObject:["attributes","size"],count:d.length,array:d,itemSize:1,usage:M.DynamicDrawUsage})),E.createElement(or.Provider,{value:f},e))})),ur=E.forwardRef((({children:e,...t},r)=>{E.useMemo((()=>o.extend({Position:tr})),[]);const n=E.useRef(),{subscribe:a}=E.useContext(or);return E.useLayoutEffect((()=>a(n)),[]),E.createElement("position",w.default({ref:T.default([r,n])},t),e)})),cr=E.forwardRef((({children:e,positions:t,colors:r,sizes:n,stride:a=3,...s},i)=>{const l=E.useRef(null);return o.useFrame((()=>{const e=l.current.geometry.attributes;e.position.needsUpdate=!0,r&&(e.color.needsUpdate=!0),n&&(e.size.needsUpdate=!0)})),E.createElement("points",w.default({matrixAutoUpdate:!1,ref:T.default([i,l])},s),E.createElement("bufferGeometry",null,E.createElement("bufferAttribute",{attachObject:["attributes","position"],count:t.length/a,array:t,itemSize:a,usage:M.DynamicDrawUsage}),r&&E.createElement("bufferAttribute",{attachObject:["attributes","color"],count:r.length/a,array:r,itemSize:3,usage:M.DynamicDrawUsage}),n&&E.createElement("bufferAttribute",{attachObject:["attributes","size"],count:n.length/a,array:n,itemSize:1,usage:M.DynamicDrawUsage})),e)})),dr=E.forwardRef(((e,t)=>e.positions instanceof Float32Array?E.createElement(cr,w.default({},e,{ref:t})):E.createElement(lr,w.default({},e,{ref:t}))));let mr,fr;const hr=E.createContext(null),pr=new M.Matrix4,vr=new M.Matrix4,gr=new M.Matrix4,xr=new M.Color,yr=new M.Vector3,wr=new M.Quaternion,Er=new M.Vector3,br=E.forwardRef((({context:e,children:t,...r},n)=>{E.useMemo((()=>o.extend({Position:tr})),[]);const a=E.useRef(),{subscribe:s,getParent:i}=E.useContext(e||hr);return E.useLayoutEffect((()=>s(a)),[]),E.createElement("position",w.default({instance:i(),instanceKey:a,ref:T.default([n,a])},r),t)})),Mr=E.forwardRef((({children:e,range:t,limit:r=1e3,frames:n=1/0,...a},s)=>{const[{context:i,instance:l}]=E.useState((()=>{const e=E.createContext(null);return{context:e,instance:E.forwardRef(((t,r)=>E.createElement(br,w.default({context:e},t,{ref:r}))))}})),u=E.useRef(null),[c,d]=E.useState([]),[[m,f]]=E.useState((()=>{const e=new Float32Array(16*r);for(mr=0;mr<r;mr++)gr.identity().toArray(e,16*mr);return[e,new Float32Array([...new Array(3*r)].map((()=>1)))]}));E.useLayoutEffect((()=>{u.current.count=u.current.instanceMatrix.updateRange.count=u.current.instanceColor.updateRange.count=Math.min(r,void 0!==t?t:r,c.length)}),[c,t]),E.useEffect((()=>{u.current.instanceMatrix.needsUpdate=!0}));let h=0;o.useFrame((()=>{if(n===1/0||h<n){for(u.current.updateMatrix(),u.current.updateMatrixWorld(),pr.copy(u.current.matrixWorld).invert(),mr=0;mr<c.length;mr++)fr=c[mr].current,fr.matrixWorld.decompose(yr,wr,Er),vr.compose(yr,wr,Er).premultiply(pr),vr.equals(gr.fromArray(m,16*mr))||(vr.toArray(m,16*mr),u.current.instanceMatrix.needsUpdate=!0),fr.color.equals(xr.fromArray(f,3*mr))||(fr.color.toArray(f,3*mr),u.current.instanceColor.needsUpdate=!0);h++}}));const p=E.useMemo((()=>({getParent:()=>u,subscribe:e=>(d((t=>[...t,e])),()=>d((t=>t.filter((t=>t.current!==e.current)))))})),[]);return E.createElement("instancedMesh",w.default({userData:{instances:c},matrixAutoUpdate:!1,ref:T.default([s,u]),args:[null,null,0],raycast:()=>null},a),E.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:m.length/16,array:m,itemSize:16,usage:M.DynamicDrawUsage}),E.createElement("instancedBufferAttribute",{attach:"instanceColor",count:f.length/3,array:f,itemSize:3,usage:M.DynamicDrawUsage}),"function"==typeof e?E.createElement(i.Provider,{value:p},e(l)):E.createElement(hr.Provider,{value:p},e))}));const Sr=E.createContext(null),Tr=e=>e instanceof M.Color?e.toArray():e,Rr=e=>e instanceof M.Vector3?e.toArray():e,Cr=E.forwardRef(((e,t)=>{const{limit:r=1e3,lineWidth:n=1,children:a,...s}=e,[i,l]=E.useState([]),[c]=E.useState((()=>new u.Line2)),[d]=E.useState((()=>new u.LineMaterial)),[m]=E.useState((()=>new u.LineSegmentsGeometry)),[f]=E.useState((()=>new M.Vector2(512,512))),[h]=E.useState((()=>Array(6*r).fill(0))),[p]=E.useState((()=>Array(6*r).fill(0))),v=E.useMemo((()=>({subscribe:e=>(l((t=>[...t,e])),()=>l((t=>t.filter((t=>t.current!==e.current)))))})),[]);return o.useFrame((()=>{for(let n=0;n<r;n++){var e;const r=null==(e=i[n])?void 0:e.current,o=r?Rr(r.start):[0,0,0],a=r?Rr(r.end):[0,0,0],s=r?Tr(r.color):[1,1,1];for(var t=0;t<3;t++)h[6*n+t]=o[t],h[6*n+t+3]=a[t],p[6*n+t]=s[t],p[6*n+t+3]=s[t]}m.setColors(p),m.setPositions(h),c.computeLineDistances()})),E.createElement("primitive",{object:c,ref:t},E.createElement("primitive",{object:m,attach:"geometry"}),E.createElement("primitive",w.default({object:d,attach:"material",vertexColors:!0,resolution:f,linewidth:n},s)),E.createElement(Sr.Provider,{value:v},a))}));class _r{constructor(){this.color=new M.Color("white"),this.start=new M.Vector3(0,0,0),this.end=new M.Vector3(0,0,0)}}const Lr=E.forwardRef(((e,t)=>{const r=E.useContext(Sr);if(!r)throw"Segment must used inside Segments component.";const n=E.useRef();return E.useMemo((()=>o.extend({SegmentObject:_r})),[]),E.useLayoutEffect((()=>r.subscribe(n)),[]),E.createElement("segmentObject",w.default({ref:T.default([n,t])},e))})),Pr=E.forwardRef((({children:e,distances:t,...r},n)=>{const a=E.useRef(null);return E.useLayoutEffect((()=>{const{current:e}=a;e.levels.length=0,e.children.forEach(((r,n)=>e.levels.push({object:r,distance:t[n]})))})),o.useFrame((e=>{var t;return null==(t=a.current)?void 0:t.update(e.camera)})),E.createElement("lOD",w.default({ref:T.default([a,n])},r),e)}));const Dr=new n.Matrix4,zr=new n.Ray,Br=new n.Sphere,Ur=new n.Vector3;exports.AdaptiveDpr=function({pixelated:e}){const t=o.useThree((e=>e.gl)),r=o.useThree((e=>e.internal.active)),n=o.useThree((e=>e.performance.current)),a=o.useThree((e=>e.viewport.initialDpr)),s=o.useThree((e=>e.setDpr));return E.useEffect((()=>{const n=t.domElement;return()=>{r&&s(a),e&&n&&(n.style.imageRendering="auto")}}),[]),E.useEffect((()=>{s(n*a),e&&t.domElement&&(t.domElement.style.imageRendering=1===n?"auto":"pixelated")}),[n]),null},exports.AdaptiveEvents=function(){const e=o.useThree((e=>e.get)),t=o.useThree((e=>e.performance.current));return E.useEffect((()=>{const t=e().raycaster.enabled;return()=>{e().raycaster.enabled=t}}),[]),E.useEffect((()=>{e().raycaster.enabled=1===t}),[t]),null},exports.ArcballControls=ve,exports.Backdrop=function({children:e,floor:t=.25,segments:r=20,receiveShadow:n,...o}){const a=E.useRef(null);return E.useLayoutEffect((()=>{let e=0;const n=r/r/2,o=a.current.attributes.position;for(let a=0;a<r+1;a++)for(let s=0;s<r+1;s++)o.setXYZ(e++,a/r-n+(0===a?-t:0),s/r-n,Vt(a/r));o.needsUpdate=!0,a.current.computeVertexNormals()}),[r,t]),E.createElement("group",o,E.createElement("mesh",{receiveShadow:n,rotation:[-Math.PI/2,0,Math.PI/2]},E.createElement("planeGeometry",{ref:a,args:[1,1,r,r]}),e))},exports.BakeShadows=function(){const e=o.useThree((e=>e.gl));return t.useEffect((()=>(e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0,()=>{e.shadowMap.autoUpdate=e.shadowMap.needsUpdate=!0})),[e.shadowMap]),null},exports.Billboard=X,exports.Bounds=function({children:e,damping:t=6,fit:r,clip:n,margin:a=1.2,eps:s=.01,onFit:i}){const l=E.useRef(null),u=o.useThree((e=>e.camera)),c=o.useThree((e=>e.controls)),d=o.useThree((e=>e.invalidate)),m=E.useRef(i);function f(e,t){return Math.abs(e.x-t.x)<s&&Math.abs(e.y-t.y)<s&&Math.abs(e.z-t.z)<s}function h(e,t,r,n){e.x=M.MathUtils.damp(e.x,t.x,r,n),e.y=M.MathUtils.damp(e.y,t.y,r,n),e.z=M.MathUtils.damp(e.z,t.z,r,n)}m.current=i;const[p]=E.useState((()=>({animating:!1,focus:new M.Vector3,camera:new M.Vector3,zoom:1}))),[v]=E.useState((()=>({focus:new M.Vector3,camera:new M.Vector3,zoom:1}))),[g]=E.useState((()=>new M.Box3)),x=E.useMemo((()=>{function e(){const e=g.getSize(new M.Vector3),t=g.getCenter(new M.Vector3),r=Math.max(e.x,e.y,e.z),n=Bt(u)?4*r:r/(2*Math.atan(Math.PI*u.fov/360)),o=Bt(u)?4*r:n/u.aspect,s=a*Math.max(n,o);return{box:g,size:e,center:t,distance:s}}return{getSize:e,refresh(t){var r;if((r=t)&&r.isObject3D?g.setFromObject(t):(e=>e&&e.isBox3)(t)?g.copy(t):l.current&&g.setFromObject(l.current),g.isEmpty()){const e=u.position.length()||10;g.setFromCenterAndSize(new M.Vector3,new M.Vector3(e,e,e))}if("OrthographicTrackballControls"===(null==c?void 0:c.constructor.name)){const{distance:t}=e(),r=u.position.clone().sub(c.target).normalize().multiplyScalar(t),n=c.target.clone().add(r);u.position.copy(n)}return this},clip(){const{distance:t}=e();return c&&(c.maxDistance=10*t),u.near=t/100,u.far=100*t,u.updateProjectionMatrix(),c&&c.update(),this},fit(){p.camera.copy(u.position),c&&p.focus.copy(c.target);const{center:r,distance:n}=e(),o=r.clone().sub(u.position).normalize().multiplyScalar(n);if(v.camera.copy(r).sub(o),v.focus.copy(r),Bt(u)){p.zoom=u.zoom;let e=0,n=0;const o=[new M.Vector3(g.min.x,g.min.y,g.min.z),new M.Vector3(g.min.x,g.max.y,g.min.z),new M.Vector3(g.min.x,g.min.y,g.max.z),new M.Vector3(g.min.x,g.max.y,g.max.z),new M.Vector3(g.max.x,g.max.y,g.max.z),new M.Vector3(g.max.x,g.max.y,g.min.z),new M.Vector3(g.max.x,g.min.y,g.max.z),new M.Vector3(g.max.x,g.min.y,g.min.z)];r.applyMatrix4(u.matrixWorldInverse);for(const t of o)t.applyMatrix4(u.matrixWorldInverse),e=Math.max(e,Math.abs(t.y-r.y)),n=Math.max(n,Math.abs(t.x-r.x));e*=2,n*=2;const s=(u.top-u.bottom)/e,i=(u.right-u.left)/n;v.zoom=Math.min(s,i)/a,t||(u.zoom=v.zoom,u.updateProjectionMatrix())}return t?p.animating=!0:(u.position.copy(v.camera),u.lookAt(v.focus),c&&(c.target.copy(v.focus),c.update()),d()),m.current&&m.current(this.getSize()),this}}}),[g,u,c,a,t,d]);return E.useLayoutEffect((()=>{if(x.refresh(),r&&x.fit(),n&&x.clip(),c){const e=()=>p.animating=!1;return c.addEventListener("start",e),()=>c.removeEventListener("start",e)}}),[n,r,c]),o.useFrame(((e,r)=>{if(p.animating){if(h(p.focus,v.focus,t,r),h(p.camera,v.camera,t,r),p.zoom=M.MathUtils.damp(p.zoom,v.zoom,t,r),u.position.copy(p.camera),Bt(u)&&(u.zoom=p.zoom,u.updateProjectionMatrix()),c?(c.target.copy(p.focus),c.update()):u.lookAt(p.focus),d(),Bt(u)&&!(Math.abs(p.zoom-v.zoom)<s))return;if(!Bt(u)&&!f(p.camera,v.camera))return;if(c&&!f(p.focus,v.focus))return;p.animating=!1}})),E.createElement("group",{ref:l},E.createElement(Ut.Provider,{value:x},e))},exports.Box=dt,exports.CameraShake=At,exports.Center=zt,exports.Circle=mt,exports.Cloud=function({opacity:e=.5,speed:t=.4,width:r=10,depth:n=1.5,segments:a=20,...s}){const i=E.useRef(),l=se("https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png"),u=E.useMemo((()=>[...new Array(a)].map(((e,n)=>({x:r/2-Math.random()*r,y:r/2-Math.random()*r,scale:.4+Math.sin((n+1)/a*Math.PI)*(10*(.2+Math.random())),density:Math.max(.2,Math.random()),rotation:Math.max(.002,.005*Math.random())*t})))),[r,a,t]);return o.useFrame((e=>{var t;return null==(t=i.current)?void 0:t.children.forEach(((t,r)=>{t.children[0].rotation.z+=u[r].rotation,t.children[0].scale.setScalar(u[r].scale+(1+Math.sin(e.clock.getElapsedTime()/10))/2*r/10)}))})),E.createElement("group",s,E.createElement("group",{position:[0,0,a/2*n],ref:i},u.map((({x:t,y:r,scale:o,density:a},s)=>E.createElement(X,{key:s,position:[t,r,-s*n]},E.createElement(vt,{scale:o,rotation:[0,0,0]},E.createElement("meshStandardMaterial",{map:l,transparent:!0,opacity:o/6*a*e,depthTest:!1})))))))},exports.Cone=ft,exports.ContactShadows=jt,exports.CubeCamera=function({children:e,fog:t,frames:r=1/0,resolution:a=256,near:s=1,far:i=1e3,...l}){const u=E.useRef(),[c,d]=E.useState(),m=o.useThree((({scene:e})=>e)),f=o.useThree((({gl:e})=>e)),h=E.useMemo((()=>new n.WebGLCubeRenderTarget(a,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBFormat,encoding:f.outputEncoding})),[a]);let p=0;return o.useFrame((()=>{if(c&&u.current&&(r===1/0||p<r)){u.current.traverse((e=>e.visible=!1));const e=m.fog;m.fog=t||e,c.update(f,m),m.fog=e,u.current.traverse((e=>e.visible=!0)),p++}})),E.createElement("group",l,E.createElement("cubeCamera",{ref:d,args:[s,i,h]}),E.createElement("group",{ref:u},e(h.texture)))},exports.CubicBezierLine=J,exports.CurveModifier=Ke,exports.CycleRaycast=function({onChanged:e,portal:t,preventDefault:r=!0,scroll:n=!0,keyCode:a=9}){const s=E.useRef(0),i=o.useThree((e=>e.raycaster)),l=o.useThree((e=>e.get)),u=o.useThree((e=>e.gl));return E.useEffect((()=>{var o;let c,d=[];const m=i.filter,f=null!==(o=null==t?void 0:t.current)&&void 0!==o?o:u.domElement.parentNode,h=()=>f&&e&&e(d,Math.round(s.current)%d.length);i.filter=(e,t)=>{let r=[...e];r.length===d.length&&d.every((e=>r.map((e=>e.object.uuid)).includes(e.object.uuid)))||(s.current=0,d=r,h()),m&&(r=m(r,t));for(let e=0;e<Math.round(s.current)%r.length;e++){const e=r.shift();r=[...r,e]}return r};const p=e=>{var t,r;s.current=e(s.current),null==(t=l().events.handlers)||t.onPointerCancel(void 0),null==(r=l().events.handlers)||r.onPointerMove(c),h()},v=e=>{(e.keyCode||e.which===a)&&(r&&e.preventDefault(),d.length>1&&p((e=>e+1)))},g=e=>{r&&e.preventDefault();let t=0;e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),d.length>1&&p((e=>Math.abs(e-t)))},x=e=>c=e;return document.addEventListener("pointermove",x,{passive:!0}),n&&document.addEventListener("wheel",g),void 0!==a&&document.addEventListener("keydown",v),()=>{i.filter=m,void 0!==a&&document.removeEventListener("keydown",v),n&&document.removeEventListener("wheel",g),document.removeEventListener("pointermove",x)}}),[u,l,i,r,n,a]),null},exports.Cylinder=ht,exports.Detailed=Pr,exports.DeviceOrientationControls=de,exports.Dodecahedron=Tt,exports.Effects=ne,exports.Environment=kt,exports.Extrude=Rt,exports.FirstPersonControls=ye,exports.Float=function({children:e,speed:t=1,rotationIntensity:r=1,floatIntensity:n=1,...a}){const s=E.useRef(null),i=E.useRef(1e4*Math.random());return o.useFrame((e=>{const o=i.current+e.clock.getElapsedTime();s.current.rotation.x=Math.cos(o/4*t)/8*r,s.current.rotation.y=Math.sin(o/4*t)/8*r,s.current.rotation.z=Math.sin(o/4*t)/20*r,s.current.position.y=Math.sin(o/4*t)/10*n})),E.createElement("group",a,E.createElement("group",{ref:s},e))},exports.FlyControls=me,exports.GizmoHelper=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:r=0,onUpdate:a,onTarget:s,children:i})=>{const l=o.useThree((({size:e})=>e)),u=o.useThree((({camera:e})=>e)),c=o.useThree((({controls:e})=>e)),d=o.useThree((({gl:e})=>e)),m=o.useThree((({scene:e})=>e)),f=o.useThree((({invalidate:e})=>e)),h=E.useRef(),p=E.useRef(),v=E.useRef(null),[g]=E.useState((()=>new n.Scene)),x=E.useRef(!1),y=E.useRef(0),w=E.useRef(new n.Vector3(0,0,0));E.useEffect((()=>(m.background&&(h.current=m.background,m.background=null,g.background=h.current),()=>{h.current&&(m.background=h.current)})),[]);o.useFrame(((e,t)=>{var r;v.current&&p.current&&((e=>{if(!x.current)return;if(Re.angleTo(Ce)<.01)return void(x.current=!1);const t=e*Me;Re.rotateTowards(Ce,t),u.position.set(0,0,1).applyQuaternion(Re).multiplyScalar(y.current).add(w.current),u.up.set(0,1,0).applyQuaternion(Re).normalize(),u.quaternion.copy(Re),a?a():c&&c.update(),f()})(t),Te.copy(u.matrix).invert(),null==(r=p.current)||r.quaternion.setFromRotationMatrix(Te),d.autoClear=!1,d.clearDepth(),d.render(g,v.current))}),r);const b={tweenCamera:e=>{x.current=!0,(c||s)&&(w.current=(null==c?void 0:c.target)||(null==s?void 0:s())),y.current=u.position.distanceTo(_e),Re.copy(u.quaternion),Le.copy(e).multiplyScalar(y.current).add(_e),Se.lookAt(Le),Ce.copy(Se.quaternion),f()},raycast:we(v)},[M,S]=t,T=e.endsWith("-left")?-l.width/2+M:l.width/2-M,R=e.startsWith("top-")?l.height/2-S:-l.height/2+S;return o.createPortal(E.createElement(Ee.Provider,{value:b},E.createElement(ue,{ref:v,makeDefault:!1,position:[0,0,200]}),E.createElement("group",{ref:p,position:[T,R,0]},i)),g)},exports.GizmoViewcube=e=>E.createElement("group",{scale:[60,60,60]},E.createElement(Oe,e),je.map(((t,r)=>E.createElement(Ge,w.default({key:r,position:t,dimensions:Ie[r]},e)))),Fe.map(((t,r)=>E.createElement(Ge,w.default({key:r,position:t,dimensions:ke},e)))),E.createElement("ambientLight",{intensity:.5}),E.createElement("pointLight",{position:[10,10,10],intensity:.5})),exports.GizmoViewport=({hideNegativeAxes:e,hideAxisHeads:t,disabled:r,font:n="18px Inter var, Arial, sans-serif",axisColors:o=["#ff3653","#0adb50","#2c8fdf"],axisHeadScale:a=1,axisScale:s,labels:i=["X","Y","Z"],labelColor:l="#000",onClick:u,...c})=>{const[d,m,f]=o,{tweenCamera:h,raycast:p}=be(),v={font:n,disabled:r,labelColor:l,raycast:p,onClick:u,axisHeadScale:a,onPointerDown:r?void 0:e=>{h(e.object.position),e.stopPropagation()}};return E.createElement("group",w.default({scale:40},c),E.createElement(We,{color:d,rotation:[0,0,0],scale:s}),E.createElement(We,{color:m,rotation:[0,0,Math.PI/2],scale:s}),E.createElement(We,{color:f,rotation:[0,-Math.PI/2,0],scale:s}),!t&&E.createElement(E.Fragment,null,E.createElement(Ne,w.default({arcStyle:d,position:[1,0,0],label:i[0]},v)),E.createElement(Ne,w.default({arcStyle:m,position:[0,1,0],label:i[1]},v)),E.createElement(Ne,w.default({arcStyle:f,position:[0,0,1],label:i[2]},v)),!e&&E.createElement(E.Fragment,null,E.createElement(Ne,w.default({arcStyle:d,position:[-1,0,0]},v)),E.createElement(Ne,w.default({arcStyle:m,position:[0,-1,0]},v)),E.createElement(Ne,w.default({arcStyle:f,position:[0,0,-1]},v)))),E.createElement("ambientLight",{intensity:.5}),E.createElement("pointLight",{position:[10,10,10],intensity:.5}))},exports.GradientTexture=function({stops:e,colors:t,size:r=2048,...n}){const o=E.useMemo((()=>{const n=document.createElement("canvas"),o=n.getContext("2d");n.width=16,n.height=r;const a=o.createLinearGradient(0,0,0,r);let s=e.length;for(;s--;)a.addColorStop(e[s],t[s]);o.fillStyle=a,o.fillRect(0,0,16,r);const i=new M.Texture(n);return i.needsUpdate=!0,i}),[e]);return E.useEffect((()=>()=>{o.dispose()}),[o]),E.createElement("primitive",w.default({object:o,attach:"map"},n))},exports.Html=I,exports.Icosahedron=Mt,exports.Image=le,exports.Instance=br,exports.Instances=Mr,exports.IsObject=ae,exports.Lathe=Ct,exports.Line=Y,exports.Loader=function({containerStyles:e,innerStyles:t,barStyles:r,dataStyles:n,dataInterpolation:o=G,initialState:a=(e=>e)}){const{active:s,progress:i}=O(),l=E.useRef(0),u=E.useRef(0),c=E.useRef(null),[d,m]=E.useState(a(s));E.useEffect((()=>{let e;return s!==d&&(e=setTimeout((()=>m(s)),300)),()=>clearTimeout(e)}),[d,s]);const f=E.useCallback((()=>{c.current&&(l.current+=(i-l.current)/2,(l.current>.95*i||100===i)&&(l.current=i),c.current.innerText=o(l.current),l.current<i&&(u.current=requestAnimationFrame(f)))}),[o,i]);return E.useEffect((()=>(f(),()=>cancelAnimationFrame(u.current))),[f]),d?E.createElement("div",{style:{...W.container,opacity:s?1:0,...e}},E.createElement("div",null,E.createElement("div",{style:{...W.inner,...t}},E.createElement("div",{style:{...W.bar,transform:`scaleX(${i/100})`,...r}}),E.createElement("span",{ref:c,style:{...W.data,...n}})))):null},exports.MapControls=fe,exports.Merged=function({meshes:e,children:t,...r}){const n=Array.isArray(e);if(!n)for(const t of Object.keys(e))e[t].isMesh||delete e[t];return E.createElement(L.default,{components:(n?e:Object.values(e)).map((({geometry:e,material:t})=>E.createElement(Mr,w.default({key:e.uuid,geometry:e,material:t},r))))},(r=>n?t(...r):t(Object.keys(e).filter((t=>e[t].isMesh)).reduce(((e,t,n)=>({...e,[t]:r[n]})),{}))))},exports.MeshDistortMaterial=et,exports.MeshReflectorMaterial=st,exports.MeshWobbleMaterial=rt,exports.Octahedron=St,exports.OrbitControls=he,exports.OrthographicCamera=ue,exports.PerspectiveCamera=ce,exports.Plane=vt,exports.Point=ur,exports.PointMaterial=lt,exports.PointMaterialImpl=it,exports.PointerLockControls=xe,exports.Points=dr,exports.PointsBuffer=cr,exports.Polyhedron=bt,exports.PositionalAudio=ee,exports.Preload=function({all:e,scene:t,camera:r}){const a=o.useThree((({gl:e})=>e)),s=o.useThree((({camera:e})=>e)),i=o.useThree((({scene:e})=>e));return E.useLayoutEffect((()=>{const o=[];e&&(t||i).traverse((e=>{!1===e.visible&&(o.push(e),e.visible=!0)})),a.compile(t||i,r||s);const l=new n.WebGLCubeRenderTarget(128);new n.CubeCamera(.01,1e5,l).update(a,t||i),l.dispose(),o.forEach((e=>e.visible=!1))}),[]),null},exports.PresentationControls=function({snap:e,global:t,children:r,speed:a=1,rotation:s=[0,0,0],zoom:u=1,polar:c=[0,Math.PI/2],azimuth:d=[-1/0,1/0],config:m={mass:1,tension:170,friction:26}}){const{size:f,gl:h}=o.useThree(),p=E.useMemo((()=>[s[0]+c[0],s[0]+c[1]]),[s[0],c[0],c[1]]),v=E.useMemo((()=>[s[1]+d[0],s[1]+d[1]]),[s[1],d[0],d[1]]),g=E.useMemo((()=>[n.MathUtils.clamp(s[0],...p),n.MathUtils.clamp(s[1],...v),s[2]]),[s[0],s[1],s[2],p,v]),[x,y]=i.useSpring((()=>({scale:1,rotation:g,config:m})));E.useEffect((()=>{y.start({scale:1,rotation:g,config:m})}),[g]),E.useEffect((()=>{t&&(document.body.style.cursor="grab")}),[t]);const b=l.useGesture({onHover:({last:e})=>{t||(document.body.style.cursor=e?"auto":"grab")},onDrag:({down:t,delta:[r,o],memo:[s,i]=x.rotation.animation.to||g})=>{document.body.style.cursor=t?"grabbing":"grab",r=n.MathUtils.clamp(i+r/f.width*Math.PI*a,...v),o=n.MathUtils.clamp(s+o/f.height*Math.PI*a,...p);const l=e&&!t&&"boolean"!=typeof e?e:m;return y.start({scale:t&&o>p[1]/2?u:1,rotation:e&&!t?g:[o,r,0],config:e=>"scale"===e?{...l,friction:3*l.friction}:l}),[o,r]}},{target:t?h.domElement:void 0});return E.createElement(i.a.group,w.default({},null==b?void 0:b(),x),r)},exports.QuadraticBezierLine=K,exports.Reflector=Gt,exports.Ring=Et,exports.RoundedBox=Lt,exports.ScreenQuad=Dt,exports.Scroll=Z,exports.ScrollControls=function({eps:e=1e-5,enabled:t=!0,infinite:r,horizontal:n,pages:a=1,distance:s=1,damping:i=4,style:l={},children:u}){const{gl:c,size:d,invalidate:m,events:f,raycaster:h}=o.useThree(),[p]=E.useState((()=>document.createElement("div"))),[v]=E.useState((()=>document.createElement("div"))),[g]=E.useState((()=>document.createElement("div"))),x=c.domElement.parentNode,y=E.useRef(0),w=E.useMemo((()=>({el:p,eps:e,fill:v,fixed:g,horizontal:n,damping:i,offset:0,delta:0,scroll:y,pages:a,range(e,t,r=0){const n=e-r,o=n+t+2*r;return this.offset<n?0:this.offset>o?1:(this.offset-n)/(o-n)},curve(e,t,r=0){return Math.sin(this.range(e,t,r)*Math.PI)},visible(e,t,r=0){const n=e-r,o=n+t+2*r;return this.offset>=n&&this.offset<=o}})),[e,i,n,a]);E.useEffect((()=>{p.style.position="absolute",p.style.width="100%",p.style.height="100%",p.style[n?"overflowX":"overflowY"]="auto",p.style[n?"overflowY":"overflowX"]="hidden",p.style.top="0px",p.style.left="0px";for(const e in l)p.style[e]=l[e];g.style.position="sticky",g.style.top="0px",g.style.left="0px",g.style.width="100%",g.style.height="100%",g.style.overflow="hidden",p.appendChild(g),v.style.height=n?"100%":a*s*100+"%",v.style.width=n?a*s*100+"%":"100%",v.style.pointerEvents="none",p.appendChild(v),x.appendChild(p),p[n?"scrollLeft":"scrollTop"]=1;const e="boolean"!=typeof f.connected?f.connected:c.domElement;requestAnimationFrame((()=>null==f.connect?void 0:f.connect(p)));const t=h.computeOffsets;return h.computeOffsets=({clientX:e,clientY:t})=>({offsetX:e-x.offsetLeft,offsetY:t-x.offsetTop}),()=>{x.removeChild(p),h.computeOffsets=t,null==f.connect||f.connect(e)}}),[a,s,n,p,v,g,x]),E.useEffect((()=>{const e=d[n?"width":"height"],o=p[n?"scrollWidth":"scrollHeight"],a=o-e;let s=0,i=!0,l=!0;const u=()=>{if(t&&!l&&(m(),s=p[n?"scrollLeft":"scrollTop"],y.current=s/a,r)){if(!i)if(s>=a){const e=1-w.offset;p[n?"scrollLeft":"scrollTop"]=1,y.current=w.offset=-e,i=!0}else if(s<=0){const e=1+w.offset;p[n?"scrollLeft":"scrollTop"]=o,y.current=w.offset=e,i=!0}i&&setTimeout((()=>i=!1),40)}};p.addEventListener("scroll",u,{passive:!0}),requestAnimationFrame((()=>l=!1));const c=e=>p.scrollLeft+=e.deltaY/2;return n&&p.addEventListener("wheel",c,{passive:!0}),()=>{p.removeEventListener("scroll",u),n&&p.removeEventListener("wheel",c)}}),[p,d,r,w,m,n]);let b=0;return o.useFrame(((t,r)=>{w.offset=M.MathUtils.damp(b=w.offset,y.current,i,r),w.delta=M.MathUtils.damp(w.delta,Math.abs(b-w.offset),i,r),w.delta>e&&m()})),E.createElement(N.Provider,{value:w},u)},exports.Segment=Lr,exports.Segments=Cr,exports.Shadow=Ot,exports.Sky=$t,exports.Sphere=pt,exports.SpotLight=Ht,exports.Stage=function({children:e,controls:t,shadows:r=!0,adjustCamera:n=!0,environment:a="city",intensity:s=1,preset:i="rembrandt",shadowBias:l=0,contactShadow:u={blur:2,opacity:.5,position:[0,0,0]},...c}){const d=It[i],m=o.useThree((e=>e.camera)),f=o.useThree((e=>e.controls)),h=E.useRef(null),p=E.useRef(null),[{radius:v,width:g,height:x},y]=E.useState({radius:0,width:0,height:0});return E.useLayoutEffect((()=>{h.current.position.set(0,0,0),h.current.updateWorldMatrix(!0,!0);const e=(new M.Box3).setFromObject(p.current),t=new M.Vector3,r=new M.Sphere,n=e.max.y-e.min.y,o=e.max.x-e.min.x;e.getCenter(t),e.getBoundingSphere(r),y({radius:r.radius,width:o,height:n}),h.current.position.set(-t.x,-t.y+n/2,-t.z)}),[e]),E.useLayoutEffect((()=>{if(n){const e=v/(x>g?1.5:2.5);m.position.set(0,.5*v,2.5*v),m.near=.1,m.far=Math.max(5e3,4*v),m.lookAt(0,e,0);const r=f||(null==t?void 0:t.current);r&&(r.target.set(0,e,0),r.update())}}),[f,v,x,g,n]),E.createElement("group",c,E.createElement("group",{ref:h},E.createElement("group",{ref:p},e)),u&&E.createElement(jt,w.default({width:2*v,height:2*v,far:v/2},u)),a&&E.createElement(kt,{preset:a}),E.createElement("ambientLight",{intensity:s/3}),E.createElement("spotLight",{penumbra:1,position:[d.main[0]*v,d.main[1]*v,d.main[2]*v],intensity:2*s,castShadow:r,"shadow-bias":l}),E.createElement("pointLight",{position:[d.fill[0]*v,d.fill[1]*v,d.fill[2]*v],intensity:s}))},exports.Stars=Yt,exports.Stats=function({showPanel:e=0,className:t,parent:r}){const n=function(e,t=[],r){const[n,o]=E.useState();return E.useLayoutEffect((()=>{const t=e();return o(t),Ye(r,t),()=>Ye(r,null)}),t),n}((()=>new _.default),[]);return E.useEffect((()=>{if(n){const a=r&&r.current||document.body;n.showPanel(e),null==a||a.appendChild(n.dom),t&&n.dom.classList.add(t);const s=o.addEffect((()=>n.begin())),i=o.addAfterEffect((()=>n.end()));return()=>{null==a||a.removeChild(n.dom),s(),i()}}}),[r,n,t,e]),null},exports.Tetrahedron=wt,exports.Text=te,exports.Torus=xt,exports.TorusKnot=yt,exports.TrackballControls=pe,exports.TransformControls=ge,exports.Tube=gt,exports.calcPosFromAngles=qt,exports.isWebGL2Available=re,exports.meshBounds=function(e,t){const r=this.geometry,n=this.material,o=this.matrixWorld;void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),Br.copy(r.boundingSphere),Br.applyMatrix4(o),!1!==e.ray.intersectsSphere(Br)&&(Dr.copy(o).invert(),zr.copy(e.ray).applyMatrix4(Dr),null!==r.boundingBox&&null===zr.intersectBox(r.boundingBox,Ur)||t.push({distance:Ur.distanceTo(e.ray.origin),point:Ur.clone(),object:this})))},exports.shaderMaterial=oe,exports.softShadows=e=>{if(!ut){ut=!0;let t=M.ShaderChunk.shadowmap_pars_fragment;t=t.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+(({frustum:e=3.75,size:t=.005,near:r=9.5,samples:n=17,rings:o=11}={})=>`#define LIGHT_WORLD_SIZE ${t}\n#define LIGHT_FRUSTUM_WIDTH ${e}\n#define LIGHT_SIZE_UV (LIGHT_WORLD_SIZE / LIGHT_FRUSTUM_WIDTH)\n#define NEAR_PLANE ${r}\n\n#define NUM_SAMPLES ${n}\n#define NUM_RINGS ${o}\n#define BLOCKER_SEARCH_NUM_SAMPLES NUM_SAMPLES\n#define PCF_NUM_SAMPLES NUM_SAMPLES\n\nvec2 poissonDisk[NUM_SAMPLES];\n\nvoid initPoissonSamples(const in vec2 randomSeed) {\n  float ANGLE_STEP = PI2 * float(NUM_RINGS) / float(NUM_SAMPLES);\n  float INV_NUM_SAMPLES = 1.0 / float(NUM_SAMPLES);\n  float angle = rand(randomSeed) * PI2;\n  float radius = INV_NUM_SAMPLES;\n  float radiusStep = radius;\n  for (int i = 0; i < NUM_SAMPLES; i++) {\n    poissonDisk[i] = vec2(cos(angle), sin(angle)) * pow(radius, 0.75);\n    radius += radiusStep;\n    angle += ANGLE_STEP;\n  }\n}\n\nfloat penumbraSize(const in float zReceiver, const in float zBlocker) { // Parallel plane estimation\n  return (zReceiver - zBlocker) / zBlocker;\n}\n\nfloat findBlocker(sampler2D shadowMap, const in vec2 uv, const in float zReceiver) {\n  float searchRadius = LIGHT_SIZE_UV * (zReceiver - NEAR_PLANE) / zReceiver;\n  float blockerDepthSum = 0.0;\n  int numBlockers = 0;\n  for (int i = 0; i < BLOCKER_SEARCH_NUM_SAMPLES; i++) {\n    float shadowMapDepth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));\n    if (shadowMapDepth < zReceiver) {\n      blockerDepthSum += shadowMapDepth;\n      numBlockers++;\n    }\n  }\n  if (numBlockers == 0) return -1.0;\n  return blockerDepthSum / float(numBlockers);\n}\n\nfloat PCF_Filter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius) {\n  float sum = 0.0;\n  for (int i = 0; i < PCF_NUM_SAMPLES; i++) {\n    float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[ i ] * filterRadius));\n    if (zReceiver <= depth) sum += 1.0;\n  }\n  for (int i = 0; i < PCF_NUM_SAMPLES; i++) {\n    float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + -poissonDisk[ i ].yx * filterRadius));\n    if (zReceiver <= depth) sum += 1.0;\n  }\n  return sum / (2.0 * float(PCF_NUM_SAMPLES));\n}\n\nfloat PCSS(sampler2D shadowMap, vec4 coords) {\n  vec2 uv = coords.xy;\n  float zReceiver = coords.z; // Assumed to be eye-space z in this code\n  initPoissonSamples(uv);\n  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver);\n  if (avgBlockerDepth == -1.0) return 1.0;\n  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);\n  float filterRadius = penumbraRatio * LIGHT_SIZE_UV * NEAR_PLANE / zReceiver;\n  return PCF_Filter(shadowMap, uv, zReceiver, filterRadius);\n}`)({...e})),t=t.replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),M.ShaderChunk.shadowmap_pars_fragment=t}},exports.useAnimations=function(e,t){const r=E.useRef(),[a]=E.useState((()=>t?t instanceof n.Object3D?{current:t}:t:r)),[s]=E.useState((()=>new n.AnimationMixer(void 0))),i=E.useRef({}),[l]=E.useState((()=>{const t={};return e.forEach((e=>Object.defineProperty(t,e.name,{enumerable:!0,get(){if(a.current)return i.current[e.name]||(i.current[e.name]=s.clipAction(e,a.current))}}))),{ref:a,clips:e,actions:t,names:e.map((e=>e.name)),mixer:s}}));return o.useFrame(((e,t)=>s.update(t))),E.useEffect((()=>{const e=a.current;return()=>{i.current={},Object.values(l.actions).forEach((t=>{e&&s.uncacheAction(t,e)}))}}),[e]),l},exports.useAspect=function(e,t,r=1){const n=o.useThree((e=>e.viewport)),a=t*(n.aspect>e/t?n.width/e:n.height/t);return[e*(n.aspect>e/t?n.width/e:n.height/t)*r,a*r,1]},exports.useBVH=function(e,t){E.useEffect((()=>{if(e.current){e.current.raycast=v.acceleratedRaycast;const r=e.current.geometry;return r.computeBoundsTree=v.computeBoundsTree,r.disposeBoundsTree=v.disposeBoundsTree,r.computeBoundsTree(t),()=>{r.boundsTree&&r.disposeBoundsTree()}}}),[e,t])},exports.useBounds=function(){return E.useContext(Ut)},exports.useCamera=we,exports.useContextBridge=function(...e){const t=E.useRef([]);return t.current=e.map((e=>E.useContext(e))),E.useMemo((()=>({children:r})=>e.reduceRight(((e,r,n)=>E.createElement(r.Provider,{value:t.current[n],children:e})),r)),[])},exports.useCubeTexture=He,exports.useCursor=function(e,t="pointer",r="auto"){E.useEffect((()=>{if(e)return document.body.style.cursor=t,()=>{document.body.style.cursor=r}}),[e])},exports.useDepthBuffer=function({size:e=256,frames:t=1/0}={}){const r=o.useThree((e=>e.viewport.dpr)),{width:a,height:s}=o.useThree((e=>e.size)),i=e||a*r,l=e||s*r,u=E.useMemo((()=>{const e=new n.DepthTexture(i,l);return e.format=n.DepthFormat,e.type=n.UnsignedShortType,{depthTexture:e}}),[i,l]);let c=0;const d=Qe(i,l,u);return o.useFrame((e=>{(t===1/0||c<t)&&(e.gl.setRenderTarget(d),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),c++)})),d.depthTexture},exports.useDetectGPU=e=>p.useAsset((()=>h.getGPUTier(e)),"useDetectGPU"),exports.useFBO=Qe,exports.useFBX=qe,exports.useGLTF=Xe,exports.useGizmoContext=be,exports.useHelper=function(e,t,...r){const n=E.useRef(),a=o.useThree((e=>e.scene));return E.useEffect((()=>(t&&e.current&&(n.current=new t(e.current,...r),n.current&&a.add(n.current)),()=>{n.current&&a.remove(n.current)})),[a,t,e,r]),o.useFrame((()=>{var e;null!=(e=n.current)&&e.update&&n.current.update()})),n},exports.useIntersect=function(e){const t=E.useRef(null),r=E.useRef(!1),n=E.useRef(!1);return E.useEffect((()=>{const a=t.current;if(a){const t=o.addEffect((()=>(r.current=!1,!0))),s=a.onBeforeRender;a.onBeforeRender=()=>r.current=!0;const i=o.addAfterEffect((()=>(r.current!==n.current&&e(n.current=r.current),!0)));return()=>{a.onBeforeRender=s,t(),i()}}}),[]),t},exports.useMatcapTexture=function(e=0,t=1024){const r=p.useAsset((()=>new Promise((async e=>{e(await fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json").then((e=>e.json())))}))),"matcapList"),n=r[0],o=E.useMemo((()=>Object.keys(r).length),[]),a=`https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d/${t}/${`${E.useMemo((()=>"string"==typeof e?e:"number"==typeof e?r[e]:null),[e])||n}${function(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}(t)}.png`}`;return[se(a),a,o]},exports.useNormalTexture=function(e=0,t={}){const{repeat:r=[1,1],anisotropy:o=1,offset:a=[0,0]}=t,s=p.useAsset((()=>new Promise((async e=>{e(await fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json").then((e=>e.json())))}))),"normalsList"),i=E.useMemo((()=>Object.keys(s).length),[]),l=s[0],u=`https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb/normals/${s[e]||l}`,c=se(u);return E.useLayoutEffect((()=>{c&&(c.wrapS=c.wrapT=n.RepeatWrapping,c.repeat=new n.Vector2(r[0],r[1]),c.offset=new n.Vector2(a[0],a[1]),c.anisotropy=o)}),[c,o,r,a]),[c,u,i]},exports.useProgress=O,exports.useScroll=H,exports.useTexture=se;
